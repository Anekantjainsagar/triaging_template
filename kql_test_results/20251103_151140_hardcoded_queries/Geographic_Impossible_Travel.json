{
  "query_name": "Geographic/Impossible Travel",
  "query_type": "hardcoded",
  "timestamp": "2025-11-03T15:11:55.035015",
  "stages": {
    "template_validation": {
      "passed": true,
      "query_length": 2024
    },
    "data_injection": {
      "passed": true,
      "injected_query_length": 2109,
      "users_injected": 1,
      "ips_injected": 1,
      "reference_datetime": "2025-11-03 10:30:00"
    },
    "execution": {
      "success": true,
      "execution_time": 1.67,
      "formatted_output": "Results: 3 row(s) returned\n\n================================================================================\nUserPrincipalName     | TravelRisk         | Country         | City            | LocationRiskScore | SignInCount     | State           | UniqueIPsInLocation | SuccessfulSignIns | FailedSignIns   | RiskySignIns    | FirstSeenInLocation          | LastSeenInLocation           | IPAddressesList    | MinTimeBetweenLocations\n---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\nanekant.jain@yash.com | ğŸ  Domestic - India | IN              | Mumbai          | 20                | 2               | Maharashtra     | 1                   | 1                 | 1               | 0               | 2025-10-31T07:18:57.1714641Z | 2025-10-31T07:19:59.7909736Z | [\"14.194.129.210\"] | 1                      \nanekant.jain@yash.com | ğŸ  Domestic - India | IN              | New Delhi       | 20                | 1               | Delhi           | 1                   | 1                 | 0               | 0               | 2025-10-31T07:18:58.4717436Z | 2025-10-31T07:18:58.4717436Z | [\"125.23.93.22\"]   | 0                      \nanekant.jain@yash.com | ğŸ  Domestic - India | IN              | Indore          | 0                 | 1               | Madhya Pradesh  | 1                   | 0                 | 1               | 0               | 2025-10-30T10:56:11.9982207Z | 2025-10-30T10:56:11.9982207Z | [\"106.219.84.254\"] | None                   \n================================================================================\n\nTotal Records: 3",
      "raw_results": {
        "tables": [
          {
            "name": "PrimaryResult",
            "columns": [
              {
                "name": "UserPrincipalName",
                "type": "string"
              },
              {
                "name": "TravelRisk",
                "type": "string"
              },
              {
                "name": "Country",
                "type": "string"
              },
              {
                "name": "City",
                "type": "string"
              },
              {
                "name": "LocationRiskScore",
                "type": "long"
              },
              {
                "name": "SignInCount",
                "type": "long"
              },
              {
                "name": "State",
                "type": "string"
              },
              {
                "name": "UniqueIPsInLocation",
                "type": "long"
              },
              {
                "name": "SuccessfulSignIns",
                "type": "long"
              },
              {
                "name": "FailedSignIns",
                "type": "long"
              },
              {
                "name": "RiskySignIns",
                "type": "long"
              },
              {
                "name": "FirstSeenInLocation",
                "type": "datetime"
              },
              {
                "name": "LastSeenInLocation",
                "type": "datetime"
              },
              {
                "name": "IPAddressesList",
                "type": "dynamic"
              },
              {
                "name": "MinTimeBetweenLocations",
                "type": "long"
              }
            ],
            "rows": [
              [
                "anekant.jain@yash.com",
                "ğŸ  Domestic - India",
                "IN",
                "Mumbai",
                20,
                2,
                "Maharashtra",
                1,
                1,
                1,
                0,
                "2025-10-31T07:18:57.1714641Z",
                "2025-10-31T07:19:59.7909736Z",
                "[\"14.194.129.210\"]",
                1
              ],
              [
                "anekant.jain@yash.com",
                "ğŸ  Domestic - India",
                "IN",
                "New Delhi",
                20,
                1,
                "Delhi",
                1,
                1,
                0,
                0,
                "2025-10-31T07:18:58.4717436Z",
                "2025-10-31T07:18:58.4717436Z",
                "[\"125.23.93.22\"]",
                0
              ],
              [
                "anekant.jain@yash.com",
                "ğŸ  Domestic - India",
                "IN",
                "Indore",
                0,
                1,
                "Madhya Pradesh",
                1,
                0,
                1,
                0,
                "2025-10-30T10:56:11.9982207Z",
                "2025-10-30T10:56:11.9982207Z",
                "[\"106.219.84.254\"]",
                null
              ]
            ]
          }
        ]
      },
      "result_rows": 1
    }
  },
  "injected_query": "SigninLogs\n| where TimeGenerated > datetime(2025-10-04 10:30:00Z) and TimeGenerated <= datetime(2025-11-03 10:30:00Z)\n| where UserPrincipalName in (\"anekant.jain@yash.com\")\n| extend\n    Country = tostring(LocationDetails.countryOrRegion),\n    City = tostring(LocationDetails.city),\n    State = tostring(LocationDetails.state),\n    Latitude = toreal(LocationDetails.geoCoordinates.latitude),\n    Longitude = toreal(LocationDetails.geoCoordinates.longitude)\n| order by TimeGenerated asc\n| extend\n    PreviousCountry = prev(Country, 1),\n    PreviousCity = prev(City, 1),\n    PreviousTime = prev(TimeGenerated, 1),\n    PreviousLatitude = prev(Latitude, 1),\n    PreviousLongitude = prev(Longitude, 1)\n| extend\n    TimeDiffMinutes = datetime_diff('minute', TimeGenerated, PreviousTime),\n    LocationChanged = iff(Country != PreviousCountry or City != PreviousCity, \"Yes\", \"No\")\n| where LocationChanged == \"Yes\"\n| summarize\n    SignInCount = count(),\n    UniqueIPsInLocation = dcount(IPAddress),\n    SuccessfulSignIns = countif(ResultType == \"0\"),\n    FailedSignIns = countif(ResultType != \"0\"),\n    RiskySignIns = countif(IsRisky == true),\n    FirstSeenInLocation = min(TimeGenerated),\n    LastSeenInLocation = max(TimeGenerated),\n    IPAddressesList = make_set(IPAddress, 5),\n    MinTimeBetweenLocations = min(TimeDiffMinutes)\n    by UserPrincipalName, Country, City, State\n| extend\n    TravelRisk = case(\n        MinTimeBetweenLocations < 60 and Country != \"IN\", \"ğŸš¨ IMPOSSIBLE TRAVEL - <1 Hour\",\n        MinTimeBetweenLocations < 180 and Country != \"IN\", \"âš ï¸ Suspicious Travel - <3 Hours\",\n        MinTimeBetweenLocations < 360 and Country != \"IN\", \"âš¡ Fast Travel - <6 Hours\",\n        Country != \"IN\", \"âœˆï¸ International Access\",\n        \"ğŸ  Domestic - India\"\n    ),\n    LocationRiskScore = case(\n        MinTimeBetweenLocations < 60, 20,\n        MinTimeBetweenLocations < 180, 15,\n        MinTimeBetweenLocations < 360, 10,\n        Country != \"IN\", 5,\n        0\n    )\n| project-reorder UserPrincipalName, TravelRisk, Country, City, LocationRiskScore, SignInCount\n| order by LocationRiskScore desc, SignInCount desc",
  "status": "PASSED"
}