====================================================================================================
Query: Initial Scope Analysis
Type: hardcoded
Status: PASSED
Timestamp: 2025-11-03T15:11:40.287151
====================================================================================================

STAGE RESULTS:
----------------------------------------------------------------------------------------------------

TEMPLATE_VALIDATION:
  passed: True
  query_length: 1319

DATA_INJECTION:
  passed: True
  injected_query_length: 1405
  users_injected: 1
  ips_injected: 1
  reference_datetime: 2025-11-03 10:30:00

EXECUTION:
  success: True
  execution_time: 7.49
  formatted_output:
    Results: 1 row(s) returned

================================================================================
UserPrincipalName     | UserDisplayName | ThreatLevel     | RiskScore       | TotalSignIns    | SuccessRate     | UniqueIPAddresses | UniqueLocations | UniqueApplications | SuccessfulSignIns | FailedSignIns   | RiskySignIns    | InteractiveSignIns | NonInteractiveSignIns | FirstActivity                | LastActivity                 | IPAddressesList                                    | LocationsList   | ApplicationsList                                   | ActivitySpanDays
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
anekant.jain@yash.com | Anekant  Jain   | Low             | 4               | 7               | 71.43           | 3                 | 1               | 4                  | 5                 | 2               | 0               | 7                  | 0                     | 2025-10-30T10:56:11.9982207Z | 2025-10-31T07:19:59.7909736Z | ["106.219.84.254","14.194.129.210","125.23.93.22"] | ["IN"]          | ["Microsoft Azure CLI","Microsoft Invitation Accep | 1               
================================================================================

Total Records: 1
  raw_results: {'tables': [{'name': 'PrimaryResult', 'columns': [{'name': 'UserPrincipalName', 'type': 'string'}, {'name': 'UserDisplayName', 'type': 'string'}, {'name': 'ThreatLevel', 'type': 'string'}, {'name': 'RiskScore', 'type': 'long'}, {'name': 'TotalSignIns', 'type': 'long'}, {'name': 'SuccessRate', 'type': 'real'}, {'name': 'UniqueIPAddresses', 'type': 'long'}, {'name': 'UniqueLocations', 'type': 'long'}, {'name': 'UniqueApplications', 'type': 'long'}, {'name': 'SuccessfulSignIns', 'type': 'long'}, {'name': 'FailedSignIns', 'type': 'long'}, {'name': 'RiskySignIns', 'type': 'long'}, {'name': 'InteractiveSignIns', 'type': 'long'}, {'name': 'NonInteractiveSignIns', 'type': 'long'}, {'name': 'FirstActivity', 'type': 'datetime'}, {'name': 'LastActivity', 'type': 'datetime'}, {'name': 'IPAddressesList', 'type': 'dynamic'}, {'name': 'LocationsList', 'type': 'dynamic'}, {'name': 'ApplicationsList', 'type': 'dynamic'}, {'name': 'ActivitySpanDays', 'type': 'long'}], 'rows': [['anekant.jain@yash.com', 'Anekant  Jain', 'Low', 4, 7, 71.43, 3, 1, 4, 5, 2, 0, 7, 0, '2025-10-30T10:56:11.9982207Z', '2025-10-31T07:19:59.7909736Z', '["106.219.84.254","14.194.129.210","125.23.93.22"]', '["IN"]', '["Microsoft Azure CLI","Microsoft Invitation Acceptance Portal","My Profile","My Apps"]', 1]]}]}
  result_rows: 1

====================================================================================================
INJECTED QUERY (READY TO EXECUTE):
====================================================================================================
SigninLogs
| where TimeGenerated > datetime(2025-10-27 10:30:00Z) and TimeGenerated <= datetime(2025-11-03 10:30:00Z)
| where UserPrincipalName in ("anekant.jain@yash.com")
| summarize
    TotalSignIns = count(),
    UniqueIPAddresses = dcount(IPAddress),
    UniqueLocations = dcount(tostring(LocationDetails.countryOrRegion)),
    UniqueApplications = dcount(AppDisplayName),
    SuccessfulSignIns = countif(ResultType == "0"),
    FailedSignIns = countif(ResultType != "0"),
    RiskySignIns = countif(IsRisky == true),
    InteractiveSignIns = countif(IsInteractive == true),
    NonInteractiveSignIns = countif(IsInteractive == false),
    FirstActivity = min(TimeGenerated),
    LastActivity = max(TimeGenerated),
    IPAddressesList = make_set(IPAddress, 10),
    LocationsList = make_set(tostring(LocationDetails.countryOrRegion), 5),
    ApplicationsList = make_set(AppDisplayName, 10)
    by UserPrincipalName, UserDisplayName
| extend
    SuccessRate = round(100.0 * SuccessfulSignIns / TotalSignIns, 2),
    RiskScore = (FailedSignIns * 2) + (RiskySignIns * 5),
    ActivitySpanDays = datetime_diff('day', LastActivity, FirstActivity),
    ThreatLevel = case(
        RiskySignIns > 5, "Critical",
        RiskySignIns > 2, "High",
        FailedSignIns > 10, "Medium",
        "Low"
    )
| project-reorder UserPrincipalName, UserDisplayName, ThreatLevel, RiskScore, TotalSignIns, SuccessRate

====================================================================================================
QUERY EXECUTION RESULTS:
====================================================================================================
Execution Time: 7.49 seconds
Result Rows: 1
Success: True

FORMATTED OUTPUT:
----------------------------------------------------------------------------------------------------
Results: 1 row(s) returned

================================================================================
UserPrincipalName     | UserDisplayName | ThreatLevel     | RiskScore       | TotalSignIns    | SuccessRate     | UniqueIPAddresses | UniqueLocations | UniqueApplications | SuccessfulSignIns | FailedSignIns   | RiskySignIns    | InteractiveSignIns | NonInteractiveSignIns | FirstActivity                | LastActivity                 | IPAddressesList                                    | LocationsList   | ApplicationsList                                   | ActivitySpanDays
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
anekant.jain@yash.com | Anekant  Jain   | Low             | 4               | 7               | 71.43           | 3                 | 1               | 4                  | 5                 | 2               | 0               | 7                  | 0                     | 2025-10-30T10:56:11.9982207Z | 2025-10-31T07:19:59.7909736Z | ["106.219.84.254","14.194.129.210","125.23.93.22"] | ["IN"]          | ["Microsoft Azure CLI","Microsoft Invitation Accep | 1               
================================================================================

Total Records: 1

====================================================================================================
RAW RESULTS (JSON):
====================================================================================================
{
  "tables": [
    {
      "name": "PrimaryResult",
      "columns": [
        {
          "name": "UserPrincipalName",
          "type": "string"
        },
        {
          "name": "UserDisplayName",
          "type": "string"
        },
        {
          "name": "ThreatLevel",
          "type": "string"
        },
        {
          "name": "RiskScore",
          "type": "long"
        },
        {
          "name": "TotalSignIns",
          "type": "long"
        },
        {
          "name": "SuccessRate",
          "type": "real"
        },
        {
          "name": "UniqueIPAddresses",
          "type": "long"
        },
        {
          "name": "UniqueLocations",
          "type": "long"
        },
        {
          "name": "UniqueApplications",
          "type": "long"
        },
        {
          "name": "SuccessfulSignIns",
          "type": "long"
        },
        {
          "name": "FailedSignIns",
          "type": "long"
        },
        {
          "name": "RiskySignIns",
          "type": "long"
        },
        {
          "name": "InteractiveSignIns",
          "type": "long"
        },
        {
          "name": "NonInteractiveSignIns",
          "type": "long"
        },
        {
          "name": "FirstActivity",
          "type": "datetime"
        },
        {
          "name": "LastActivity",
          "type": "datetime"
        },
        {
          "name": "IPAddressesList",
          "type": "dynamic"
        },
        {
          "name": "LocationsList",
          "type": "dynamic"
        },
        {
          "name": "ApplicationsList",
          "type": "dynamic"
        },
        {
          "name": "ActivitySpanDays",
          "type": "long"
        }
      ],
      "rows": [
        [
          "anekant.jain@yash.com",
          "Anekant  Jain",
          "Low",
          4,
          7,
          71.43,
          3,
          1,
          4,
          5,
          2,
          0,
          7,
          0,
          "2025-10-30T10:56:11.9982207Z",
          "2025-10-31T07:19:59.7909736Z",
          "[\"106.219.84.254\",\"14.194.129.210\",\"125.23.93.22\"]",
          "[\"IN\"]",
          "[\"Microsoft Azure CLI\",\"Microsoft Invitation Acceptance Portal\",\"My Profile\",\"My Apps\"]",
          1
        ]
      ]
    }
  ]
}
