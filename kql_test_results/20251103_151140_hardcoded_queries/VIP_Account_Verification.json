{
  "query_name": "VIP Account Verification",
  "query_type": "hardcoded",
  "timestamp": "2025-11-03T15:11:51.570731",
  "stages": {
    "template_validation": {
      "passed": true,
      "query_length": 1592
    },
    "data_injection": {
      "passed": true,
      "injected_query_length": 1677,
      "users_injected": 1,
      "ips_injected": 1,
      "reference_datetime": "2025-11-03 10:30:00"
    },
    "execution": {
      "success": true,
      "execution_time": 2.95,
      "formatted_output": "Results: 1 row(s) returned\n\n================================================================================\nUserPrincipalName     | UserDisplayName | AccountClassification      | VIPRiskScore    | ActivityPattern | UserId                               | TotalSignIns    | UniqueIPAddresses | UniqueCountries | UniqueApplications | HighRiskSignIns | MediumRiskSignIns | LowRiskSignIns  | FailedAttempts  | SuccessfulSignIns | RiskyBehavior   | UniqueDaysActive | FirstSeen                    | LastSeen                     | RiskEventTypes \n-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\nanekant.jain@yash.com | Anekant  Jain   | 游리 Medium - Monitor Closely | 7               | Sporadic        | ae662d67-fe3f-4da0-8ed7-f47da60c5baf | 7               | 3                 | 1               | 4                  | 0               | 0                 | 0               | 2               | 5                 | 0               | 2                | 2025-10-30T10:56:11.9982207Z | 2025-10-31T07:19:59.7909736Z | [\"[]\"]         \n================================================================================\n\nTotal Records: 1",
      "raw_results": {
        "tables": [
          {
            "name": "PrimaryResult",
            "columns": [
              {
                "name": "UserPrincipalName",
                "type": "string"
              },
              {
                "name": "UserDisplayName",
                "type": "string"
              },
              {
                "name": "AccountClassification",
                "type": "string"
              },
              {
                "name": "VIPRiskScore",
                "type": "long"
              },
              {
                "name": "ActivityPattern",
                "type": "string"
              },
              {
                "name": "UserId",
                "type": "string"
              },
              {
                "name": "TotalSignIns",
                "type": "long"
              },
              {
                "name": "UniqueIPAddresses",
                "type": "long"
              },
              {
                "name": "UniqueCountries",
                "type": "long"
              },
              {
                "name": "UniqueApplications",
                "type": "long"
              },
              {
                "name": "HighRiskSignIns",
                "type": "long"
              },
              {
                "name": "MediumRiskSignIns",
                "type": "long"
              },
              {
                "name": "LowRiskSignIns",
                "type": "long"
              },
              {
                "name": "FailedAttempts",
                "type": "long"
              },
              {
                "name": "SuccessfulSignIns",
                "type": "long"
              },
              {
                "name": "RiskyBehavior",
                "type": "long"
              },
              {
                "name": "UniqueDaysActive",
                "type": "long"
              },
              {
                "name": "FirstSeen",
                "type": "datetime"
              },
              {
                "name": "LastSeen",
                "type": "datetime"
              },
              {
                "name": "RiskEventTypes",
                "type": "dynamic"
              }
            ],
            "rows": [
              [
                "anekant.jain@yash.com",
                "Anekant  Jain",
                "游리 Medium - Monitor Closely",
                7,
                "Sporadic",
                "ae662d67-fe3f-4da0-8ed7-f47da60c5baf",
                7,
                3,
                1,
                4,
                0,
                0,
                0,
                2,
                5,
                0,
                2,
                "2025-10-30T10:56:11.9982207Z",
                "2025-10-31T07:19:59.7909736Z",
                "[\"[]\"]"
              ]
            ]
          }
        ]
      },
      "result_rows": 1
    }
  },
  "injected_query": "SigninLogs\n| where TimeGenerated > datetime(2025-10-04 10:30:00Z) and TimeGenerated <= datetime(2025-11-03 10:30:00Z)\n| where UserPrincipalName in (\"anekant.jain@yash.com\")\n| summarize\n    TotalSignIns = count(),\n    UniqueIPAddresses = dcount(IPAddress),\n    UniqueCountries = dcount(tostring(LocationDetails.countryOrRegion)),\n    UniqueApplications = dcount(AppDisplayName),\n    HighRiskSignIns = countif(RiskLevelAggregated == \"high\"),\n    MediumRiskSignIns = countif(RiskLevelAggregated == \"medium\"),\n    LowRiskSignIns = countif(RiskLevelAggregated == \"low\"),\n    FailedAttempts = countif(ResultType != \"0\"),\n    SuccessfulSignIns = countif(ResultType == \"0\"),\n    RiskyBehavior = countif(IsRisky == true),\n    UniqueDaysActive = dcount(format_datetime(TimeGenerated, 'yyyy-MM-dd')),\n    FirstSeen = min(TimeGenerated),\n    LastSeen = max(TimeGenerated),\n    RiskEventTypes = make_set(RiskEventTypes_V2, 10)\n    by UserPrincipalName, UserDisplayName, UserId\n| extend\n    VIPRiskScore = (HighRiskSignIns * 10) + (MediumRiskSignIns * 5) + (FailedAttempts * 2) + (UniqueCountries * 3)\n| extend\n    AccountClassification = case(\n        VIPRiskScore > 30, \"游댮 Critical - Executive at High Risk\",\n        VIPRiskScore > 15, \"游 High - VIP Requires Attention\", \n        VIPRiskScore > 5, \"游리 Medium - Monitor Closely\",\n        \"游릭 Low - Normal Activity\"\n    ),\n    ActivityPattern = case(\n        UniqueDaysActive >= 25, \"Very Active\",\n        UniqueDaysActive >= 15, \"Active\",\n        UniqueDaysActive >= 5, \"Moderate\",\n        \"Sporadic\"\n    )\n| project-reorder UserPrincipalName, UserDisplayName, AccountClassification, VIPRiskScore, ActivityPattern\n| order by VIPRiskScore desc",
  "status": "PASSED"
}