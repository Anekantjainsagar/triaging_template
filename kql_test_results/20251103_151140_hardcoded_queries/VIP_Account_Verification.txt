====================================================================================================
Query: VIP Account Verification
Type: hardcoded
Status: PASSED
Timestamp: 2025-11-03T15:11:51.570731
====================================================================================================

STAGE RESULTS:
----------------------------------------------------------------------------------------------------

TEMPLATE_VALIDATION:
  passed: True
  query_length: 1592

DATA_INJECTION:
  passed: True
  injected_query_length: 1677
  users_injected: 1
  ips_injected: 1
  reference_datetime: 2025-11-03 10:30:00

EXECUTION:
  success: True
  execution_time: 2.95
  formatted_output:
    Results: 1 row(s) returned

================================================================================
UserPrincipalName     | UserDisplayName | AccountClassification      | VIPRiskScore    | ActivityPattern | UserId                               | TotalSignIns    | UniqueIPAddresses | UniqueCountries | UniqueApplications | HighRiskSignIns | MediumRiskSignIns | LowRiskSignIns  | FailedAttempts  | SuccessfulSignIns | RiskyBehavior   | UniqueDaysActive | FirstSeen                    | LastSeen                     | RiskEventTypes 
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
anekant.jain@yash.com | Anekant  Jain   | 游리 Medium - Monitor Closely | 7               | Sporadic        | ae662d67-fe3f-4da0-8ed7-f47da60c5baf | 7               | 3                 | 1               | 4                  | 0               | 0                 | 0               | 2               | 5                 | 0               | 2                | 2025-10-30T10:56:11.9982207Z | 2025-10-31T07:19:59.7909736Z | ["[]"]         
================================================================================

Total Records: 1
  raw_results: {'tables': [{'name': 'PrimaryResult', 'columns': [{'name': 'UserPrincipalName', 'type': 'string'}, {'name': 'UserDisplayName', 'type': 'string'}, {'name': 'AccountClassification', 'type': 'string'}, {'name': 'VIPRiskScore', 'type': 'long'}, {'name': 'ActivityPattern', 'type': 'string'}, {'name': 'UserId', 'type': 'string'}, {'name': 'TotalSignIns', 'type': 'long'}, {'name': 'UniqueIPAddresses', 'type': 'long'}, {'name': 'UniqueCountries', 'type': 'long'}, {'name': 'UniqueApplications', 'type': 'long'}, {'name': 'HighRiskSignIns', 'type': 'long'}, {'name': 'MediumRiskSignIns', 'type': 'long'}, {'name': 'LowRiskSignIns', 'type': 'long'}, {'name': 'FailedAttempts', 'type': 'long'}, {'name': 'SuccessfulSignIns', 'type': 'long'}, {'name': 'RiskyBehavior', 'type': 'long'}, {'name': 'UniqueDaysActive', 'type': 'long'}, {'name': 'FirstSeen', 'type': 'datetime'}, {'name': 'LastSeen', 'type': 'datetime'}, {'name': 'RiskEventTypes', 'type': 'dynamic'}], 'rows': [['anekant.jain@yash.com', 'Anekant  Jain', '游리 Medium - Monitor Closely', 7, 'Sporadic', 'ae662d67-fe3f-4da0-8ed7-f47da60c5baf', 7, 3, 1, 4, 0, 0, 0, 2, 5, 0, 2, '2025-10-30T10:56:11.9982207Z', '2025-10-31T07:19:59.7909736Z', '["[]"]']]}]}
  result_rows: 1

====================================================================================================
INJECTED QUERY (READY TO EXECUTE):
====================================================================================================
SigninLogs
| where TimeGenerated > datetime(2025-10-04 10:30:00Z) and TimeGenerated <= datetime(2025-11-03 10:30:00Z)
| where UserPrincipalName in ("anekant.jain@yash.com")
| summarize
    TotalSignIns = count(),
    UniqueIPAddresses = dcount(IPAddress),
    UniqueCountries = dcount(tostring(LocationDetails.countryOrRegion)),
    UniqueApplications = dcount(AppDisplayName),
    HighRiskSignIns = countif(RiskLevelAggregated == "high"),
    MediumRiskSignIns = countif(RiskLevelAggregated == "medium"),
    LowRiskSignIns = countif(RiskLevelAggregated == "low"),
    FailedAttempts = countif(ResultType != "0"),
    SuccessfulSignIns = countif(ResultType == "0"),
    RiskyBehavior = countif(IsRisky == true),
    UniqueDaysActive = dcount(format_datetime(TimeGenerated, 'yyyy-MM-dd')),
    FirstSeen = min(TimeGenerated),
    LastSeen = max(TimeGenerated),
    RiskEventTypes = make_set(RiskEventTypes_V2, 10)
    by UserPrincipalName, UserDisplayName, UserId
| extend
    VIPRiskScore = (HighRiskSignIns * 10) + (MediumRiskSignIns * 5) + (FailedAttempts * 2) + (UniqueCountries * 3)
| extend
    AccountClassification = case(
        VIPRiskScore > 30, "游댮 Critical - Executive at High Risk",
        VIPRiskScore > 15, "游 High - VIP Requires Attention", 
        VIPRiskScore > 5, "游리 Medium - Monitor Closely",
        "游릭 Low - Normal Activity"
    ),
    ActivityPattern = case(
        UniqueDaysActive >= 25, "Very Active",
        UniqueDaysActive >= 15, "Active",
        UniqueDaysActive >= 5, "Moderate",
        "Sporadic"
    )
| project-reorder UserPrincipalName, UserDisplayName, AccountClassification, VIPRiskScore, ActivityPattern
| order by VIPRiskScore desc

====================================================================================================
QUERY EXECUTION RESULTS:
====================================================================================================
Execution Time: 2.95 seconds
Result Rows: 1
Success: True

FORMATTED OUTPUT:
----------------------------------------------------------------------------------------------------
Results: 1 row(s) returned

================================================================================
UserPrincipalName     | UserDisplayName | AccountClassification      | VIPRiskScore    | ActivityPattern | UserId                               | TotalSignIns    | UniqueIPAddresses | UniqueCountries | UniqueApplications | HighRiskSignIns | MediumRiskSignIns | LowRiskSignIns  | FailedAttempts  | SuccessfulSignIns | RiskyBehavior   | UniqueDaysActive | FirstSeen                    | LastSeen                     | RiskEventTypes 
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
anekant.jain@yash.com | Anekant  Jain   | 游리 Medium - Monitor Closely | 7               | Sporadic        | ae662d67-fe3f-4da0-8ed7-f47da60c5baf | 7               | 3                 | 1               | 4                  | 0               | 0                 | 0               | 2               | 5                 | 0               | 2                | 2025-10-30T10:56:11.9982207Z | 2025-10-31T07:19:59.7909736Z | ["[]"]         
================================================================================

Total Records: 1

====================================================================================================
RAW RESULTS (JSON):
====================================================================================================
{
  "tables": [
    {
      "name": "PrimaryResult",
      "columns": [
        {
          "name": "UserPrincipalName",
          "type": "string"
        },
        {
          "name": "UserDisplayName",
          "type": "string"
        },
        {
          "name": "AccountClassification",
          "type": "string"
        },
        {
          "name": "VIPRiskScore",
          "type": "long"
        },
        {
          "name": "ActivityPattern",
          "type": "string"
        },
        {
          "name": "UserId",
          "type": "string"
        },
        {
          "name": "TotalSignIns",
          "type": "long"
        },
        {
          "name": "UniqueIPAddresses",
          "type": "long"
        },
        {
          "name": "UniqueCountries",
          "type": "long"
        },
        {
          "name": "UniqueApplications",
          "type": "long"
        },
        {
          "name": "HighRiskSignIns",
          "type": "long"
        },
        {
          "name": "MediumRiskSignIns",
          "type": "long"
        },
        {
          "name": "LowRiskSignIns",
          "type": "long"
        },
        {
          "name": "FailedAttempts",
          "type": "long"
        },
        {
          "name": "SuccessfulSignIns",
          "type": "long"
        },
        {
          "name": "RiskyBehavior",
          "type": "long"
        },
        {
          "name": "UniqueDaysActive",
          "type": "long"
        },
        {
          "name": "FirstSeen",
          "type": "datetime"
        },
        {
          "name": "LastSeen",
          "type": "datetime"
        },
        {
          "name": "RiskEventTypes",
          "type": "dynamic"
        }
      ],
      "rows": [
        [
          "anekant.jain@yash.com",
          "Anekant  Jain",
          "游리 Medium - Monitor Closely",
          7,
          "Sporadic",
          "ae662d67-fe3f-4da0-8ed7-f47da60c5baf",
          7,
          3,
          1,
          4,
          0,
          0,
          0,
          2,
          5,
          0,
          2,
          "2025-10-30T10:56:11.9982207Z",
          "2025-10-31T07:19:59.7909736Z",
          "[\"[]\"]"
        ]
      ]
    }
  ]
}
