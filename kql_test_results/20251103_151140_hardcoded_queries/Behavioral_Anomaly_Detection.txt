====================================================================================================
Query: Behavioral Anomaly Detection
Type: hardcoded
Status: FAILED
Timestamp: 2025-11-03T15:11:59.864161
====================================================================================================

STAGE RESULTS:
----------------------------------------------------------------------------------------------------

TEMPLATE_VALIDATION:
  passed: True
  query_length: 2220

DATA_INJECTION:
  passed: True
  injected_query_length: 2305
  users_injected: 1
  ips_injected: 1
  reference_datetime: 2025-11-03 10:30:00

EXECUTION:
  success: False
  execution_time: 1.64
  formatted_output:
    Query failed: 400 - {"error":{"message":"The request had some invalid properties","code":"BadArgumentError","correlationId":"922151f1-827a-4c12-9b59-d276a39f5e08","innererror":{"code":"SemanticError","message":"A semantic error occurred.","innererror":{"code":"SEM0100","message":"'extend' operator: Failed to resolve column or scalar expression named 'DayOfWeek'"}}}}
  raw_results: None
  result_rows: 0
  error:
    Query failed: 400 - {"error":{"message":"The request had some invalid properties","code":"BadArgumentError","correlationId":"922151f1-827a-4c12-9b59-d276a39f5e08","innererror":{"code":"SemanticError","message":"A semantic error occurred.","innererror":{"code":"SEM0100","message":"'extend' operator: Failed to resolve column or scalar expression named 'DayOfWeek'"}}}}

====================================================================================================
INJECTED QUERY (READY TO EXECUTE):
====================================================================================================
SigninLogs
| where TimeGenerated > datetime(2025-10-20 10:30:00Z) and TimeGenerated <= datetime(2025-11-03 10:30:00Z)
| where UserPrincipalName in ("anekant.jain@yash.com")
| extend
    Hour = datetime_part("Hour", TimeGenerated),
    DayOfWeek = dayofweek(TimeGenerated),
    DayName = case(
        DayOfWeek == 0, "Sunday",
        DayOfWeek == 1, "Monday",
        DayOfWeek == 2, "Tuesday",
        DayOfWeek == 3, "Wednesday",
        DayOfWeek == 4, "Thursday",
        DayOfWeek == 5, "Friday",
        DayOfWeek == 6, "Saturday",
        "Unknown"
    ),
    IsBusinessHours = iff(Hour >= 8 and Hour <= 18 and DayOfWeek >= 1 and DayOfWeek <= 5, "Yes", "No"),
    TimeWindow = case(
        Hour >= 0 and Hour < 6, "Late Night (12AM-6AM)",
        Hour >= 6 and Hour < 9, "Early Morning (6AM-9AM)",
        Hour >= 9 and Hour < 12, "Morning (9AM-12PM)",
        Hour >= 12 and Hour < 14, "Lunch (12PM-2PM)",
        Hour >= 14 and Hour < 18, "Afternoon (2PM-6PM)",
        Hour >= 18 and Hour < 22, "Evening (6PM-10PM)",
        "Night (10PM-12AM)"
    )
| summarize
    SignInCount = count(),
    UniqueIPAddresses = dcount(IPAddress),
    UniqueApplications = dcount(AppDisplayName),
    UniqueDevices = dcount(tostring(DeviceDetail.deviceId)),
    SuccessfulSignIns = countif(ResultType == "0"),
    FailedSignIns = countif(ResultType != "0"),
    RiskySignIns = countif(IsRisky == true),
    IPsList = make_set(IPAddress, 5),
    ApplicationsList = make_set(AppDisplayName, 5)
    by UserPrincipalName, DayName, TimeWindow, IsBusinessHours, Hour
| extend
    AnomalyScore = case(
        IsBusinessHours == "No" and SignInCount > 20, 25,
        IsBusinessHours == "No" and SignInCount > 10, 20,
        IsBusinessHours == "No" and UniqueIPAddresses > 3, 15,
        IsBusinessHours == "No" and RiskySignIns > 0, 18,
        RiskySignIns > 0, 10,
        FailedSignIns > 5, 8,
        0
    ),
    BehaviorFlag = case(
        AnomalyScore >= 20, "üî¥ Critical Anomaly",
        AnomalyScore >= 15, "üü† High Anomaly",
        AnomalyScore >= 10, "üü° Medium Anomaly",
        AnomalyScore > 0, "‚ö†Ô∏è Low Anomaly",
        "‚úÖ Normal"
    )
| project-reorder UserPrincipalName, BehaviorFlag, AnomalyScore, DayName, TimeWindow, IsBusinessHours, SignInCount
| order by AnomalyScore desc, SignInCount desc

====================================================================================================
QUERY EXECUTION RESULTS:
====================================================================================================
Execution Time: 1.64 seconds
Result Rows: 0
Success: False

FORMATTED OUTPUT:
----------------------------------------------------------------------------------------------------
Query failed: 400 - {"error":{"message":"The request had some invalid properties","code":"BadArgumentError","correlationId":"922151f1-827a-4c12-9b59-d276a39f5e08","innererror":{"code":"SemanticError","message":"A semantic error occurred.","innererror":{"code":"SEM0100","message":"'extend' operator: Failed to resolve column or scalar expression named 'DayOfWeek'"}}}}

====================================================================================================
RAW RESULTS (JSON):
====================================================================================================
null

====================================================================================================
ERROR DETAILS:
====================================================================================================
Query failed: 400 - {"error":{"message":"The request had some invalid properties","code":"BadArgumentError","correlationId":"922151f1-827a-4c12-9b59-d276a39f5e08","innererror":{"code":"SemanticError","message":"A semantic error occurred.","innererror":{"code":"SEM0100","message":"'extend' operator: Failed to resolve column or scalar expression named 'DayOfWeek'"}}}}
