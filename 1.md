INFO:backend.predictions_backend:Attempting to configure Gemini API...
INFO:backend.predictions_backend:Gemini API configured.
INFO:backend.predictions_backend:Attempting to initialize GenerativeModel...
INFO:backend.predictions_backend:GenerativeModel initialized.
‚úÖ Investigation Analyzer initialized with API key
INFO:     127.0.0.1:57427 - "POST /predictions/analyze/complete?api_key=AIzaSyDL1Bg1Cpk7XUiPTp4O4bn4jb5VgISY9Lw HTTP/1.1" 500 Internal Server 
Error
INFO:     127.0.0.1:57427 - "GET /predictions/upload/preview HTTP/1.1" 200 OK
INFO:     127.0.0.1:57427 - "GET /predictions/status HTTP/1.1" 200 OK
INFO:routes.predictions_router:============================================================
INFO:routes.predictions_router:ANALYZE INITIAL REQUEST: temp.user@abc.com
INFO:routes.predictions_router:Uploaded data shape: (5, 8)
INFO:routes.predictions_router:Uploaded data columns: ['Step', 'Name', 'Explanation', 'KQL Query', 'KQL Explanation', 'Execute', 'Output', 'Remarks/Comments']
INFO:backend.backed_fixes:============================================================
INFO:backend.backed_fixes:EXTRACTING STEPS FOR: temp.user@abc.com
INFO:backend.backed_fixes:Total rows in DataFrame: 5
INFO:backend.backed_fixes:Columns: ['Step', 'Name', 'Explanation', 'KQL Query', 'KQL Explanation', 'Execute', 'Output', 'Remarks/Comments']   
INFO:backend.backed_fixes:Row 0: SKIPPED (Header row - Step=None, Name=297)
INFO:backend.backed_fixes:Row 1: ‚úÖ Step 1 - Verify User Count Impacted (Output: 79ch, Remarks: 0ch)
INFO:backend.backed_fixes:Row 2: ‚úÖ Step 2 - Verify VIP User Accounts (Output: 79ch, Remarks: 0ch)
INFO:backend.backed_fixes:Row 3: ‚úÖ Step 3 - Verify IP/User/Time/Location (Output: 79ch, Remarks: 0ch)
INFO:backend.backed_fixes:Row 4: ‚úÖ Step 4 - Verify IP Reputation Using VirusTotal (Output: 547ch, Remarks: 0ch)
INFO:backend.backed_fixes:============================================================
INFO:backend.backed_fixes:EXTRACTION COMPLETE: 4 steps extracted
INFO:routes.predictions_router:Extracted 4 steps
INFO:routes.predictions_router:First step: Verify User Count Impacted
INFO:routes.predictions_router:First step output length: 79
INFO:backend.predictions_backend:Initial analysis for temp.user@abc.com
INFO:backend.predictions_backend:Total steps: 4
INFO:backend.predictions_backend:Steps with output: 4
INFO:backend.predictions_backend:Sending prompt to Gemini API...
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1761317324.499299   25780 alts_credentials.cc:93] ALTS creds ignored. Not running on GCP and untrusted ALTS is not enabled.       
INFO:backend.predictions_backend:Gemini response length: 2241
INFO:backend.predictions_backend:Cleaned response preview: {\n  "classification": "FALSE POSITIVE",\n  "risk_level": "Low",\n  "confidence_score": 75,\n  "key_findings": [\n    {\n      "step_reference": "Verify User Count Impacted",\n      "category": "User
ERROR:backend.predictions_backend:JSON parse error: Expecting property name enclosed in double quotes: line 1 column 2 (char 1)
ERROR:backend.predictions_backend:Raw content: {
  "classification": "FALSE POSITIVE",
  "risk_level": "Low",
  "confidence_score": 75,
  "key_findings": [
    {
      "step_reference": "Verify User Count Impacted",
      "category": "User Account Activity",
      "severity": "Low",
      "details": "User temp.user@abc.com has a sign-in count of 72, accessed from 4 unique IPs, and had 2 failed attempts.",
      "evidence": "UserPrincipalName\tSignInCount\tUniqueIPs\tFailedAttempts\ntemp.user@abc.com\t72\t4\t2",
      "impact": "Potentially normal user behavior, requires further investigation only if other indicators are present."
    },
    {
      "step_reference": "Verify VIP User Accounts",
      "category": "Access Control",
      "severity": "Low",
      "details": "User temp.user@abc.com has a sign-in count of 72, accessed from 4 unique IPs, and had 2 failed attempts. Assuming user is not VIP based on no flags.",
      "evidence": "UserPrincipalName\tSignInCount\tUniqueIPs\tFailedAttempts\ntemp.user@abc.com\t72\t4\t2",
      "impact": "No immediate threat detected."
    },
    {
      "step_reference": "Verify IP/User/Time/Location",
      "category": "Login Analysis",
      "severity": "Low",
      "details": "User temp.user@abc.com has a sign-in count of 72, accessed from 4 unique IPs, and had 2 failed attempts. Needs further investigation with Geo Location and device history.",
      "evidence": "UserPrincipalName\tSignInCount\tUniqueIPs\tFailedAttempts\ntemp.user@abc.com\t72\t4\t2",
      "impact": "No immediate threat detected, pending further analysis of geolocation and device history."
    },
    {
      "step_reference": "Verify IP Reputation Using VirusTotal",
      "category": "IP Reputation",
      "severity": "Low",
      "details": "IP address 8.8.8.8 is clean based on VirusTotal analysis.",
      "evidence": "VirusTotal IP Reputation Check: IP appears clean. Continue with standard investigation.",
      "impact": "No threat associated with this IP address."
    }
  ],
  "risk_indicators": [
    {
      "indicator": "Failed Login Attempts",
      "severity": "Low",
      "evidence": "2 failed login attempts. Needs to be correlated with successful attempts and timeframe. Could indicate a mistyped password."
    }
  ]
}
INFO:backend.predictions_backend:Using fallback analysis
INFO:routes.predictions_router:Analysis complete: TRUE POSITIVE
INFO:     127.0.0.1:57427 - "POST /predictions/analyze/initial?api_key=AIzaSyDL1Bg1Cpk7XUiPTp4O4bn4jb5VgISY9Lw HTTP/1.1" 200 OK





üìä Data preview: 5 rows loaded

‚ùå Analysis failed: 500 Server Error: Internal Server Error for url: http://localhost:8000/predictions/analyze/complete?api_key=AIzaSyDL1Bg1Cpk7XUiPTp4O4bn4jb5VgISY9Lw

üîç Debug Information

Upload Status:

{
"success":true
"total_rows":5
"columns":[...]
"preview_data":[...]
"timestamp":"2025-10-24T20:18:44.419987"
}
API Status:

{
"status":"healthy"
"timestamp":"2025-10-24T20:18:44.429039"
"analyzer_loaded":true
"data_loaded":true
"total_analyses":0
"cached_analyses":0
}
Testing Initial Analysis:

{
"success":true
"username":"temp.user@abc.com"
"classification":"TRUE POSITIVE"
"risk_level":"High"
"confidence_score":95
"summary":"Failed attempts or suspicious indicators detected"
"timestamp":"2025-10-24T20:18:51.301625"
}