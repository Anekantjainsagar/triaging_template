This is the output that it is generating the problems are

You're not directly taking all the steps so sometimes steps are common so directly take all teh steps just explaination oyu have to update it from your own and kql query

Sometimes in explaination getting prompt directly so not correct

Validate kql query that it is relevent or not to the step 

Also don't hardcode any data just use llm wisely give me the updated sections only not full code required