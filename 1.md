INFO:     127.0.0.1:57568 - "GET /predictions/upload/preview HTTP/1.1" 200 OK
INFO:     127.0.0.1:57568 - "GET /predictions/upload/preview HTTP/1.1" 200 OK
INFO:backend.predictions_backend:Attempting to configure Gemini API...
INFO:backend.predictions_backend:Gemini API configured.
INFO:backend.predictions_backend:Attempting to initialize GenerativeModel...
INFO:backend.predictions_backend:GenerativeModel initialized.
‚úÖ Investigation Analyzer initialized with API key
INFO:     127.0.0.1:57568 - "POST /predictions/analyze/complete?api_key=AIzaSyDL1Bg1Cpk7XUiPTp4O4bn4jb5VgISY9Lw HTTP/1.1" 500 Internal Server 
Error
INFO:     127.0.0.1:57568 - "GET /predictions/upload/preview HTTP/1.1" 200 OK
INFO:     127.0.0.1:57568 - "GET /predictions/status HTTP/1.1" 200 OK
INFO:routes.predictions_router:============================================================
INFO:routes.predictions_router:ANALYZE INITIAL REQUEST: temp.user@abc.com
INFO:routes.predictions_router:Uploaded data shape: (5, 8)
INFO:routes.predictions_router:Uploaded data columns: ['Step', 'Name', 'Explanation', 'KQL Query', 'KQL Explanation', 'Execute', 'Output', 'Remarks/Comments']
INFO:backend.backed_fixes:============================================================
INFO:backend.backed_fixes:EXTRACTING STEPS FOR: temp.user@abc.com
INFO:backend.backed_fixes:Total rows in DataFrame: 5
INFO:backend.backed_fixes:Columns: ['Step', 'Name', 'Explanation', 'KQL Query', 'KQL Explanation', 'Execute', 'Output', 'Remarks/Comments']   
INFO:backend.backed_fixes:Row 0: SKIPPED (Header row - Step=None, Name=297)
INFO:backend.backed_fixes:Row 1: ‚úÖ Step 1 - Verify User Count Impacted (Output: 79ch, Remarks: 0ch)
INFO:backend.backed_fixes:Row 2: ‚úÖ Step 2 - Verify VIP User Accounts (Output: 79ch, Remarks: 0ch)
INFO:backend.backed_fixes:Row 3: ‚úÖ Step 3 - Verify IP/User/Time/Location (Output: 79ch, Remarks: 0ch)
INFO:backend.backed_fixes:Row 4: ‚úÖ Step 4 - Verify IP Reputation Using VirusTotal (Output: 547ch, Remarks: 0ch)
INFO:backend.backed_fixes:============================================================
INFO:backend.backed_fixes:EXTRACTION COMPLETE: 4 steps extracted
INFO:routes.predictions_router:Extracted 4 steps
INFO:routes.predictions_router:First step: Verify User Count Impacted
INFO:routes.predictions_router:First step output length: 79
INFO:backend.predictions_backend:Initial analysis for temp.user@abc.com
INFO:backend.predictions_backend:Total steps: 4
INFO:backend.predictions_backend:Steps with output: 4
INFO:backend.predictions_backend:Sending prompt to Gemini API...
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1761317959.607498   26348 alts_credentials.cc:93] ALTS creds ignored. Not running on GCP and untrusted ALTS is not enabled.
INFO:backend.predictions_backend:Gemini response length: 158
INFO:backend.predictions_backend:Cleaned response preview: {\n    "classification": "FALSE POSITIVE",\n    "risk_level": "Low",\n    "confidence_score": 80,\n    "key_findings": [],\n    "risk_indicators": []\n}
ERROR:backend.predictions_backend:JSON parse error: Expecting property name enclosed in double quotes: line 1 column 2 (char 1)
ERROR:backend.predictions_backend:Raw content: {
    "classification": "FALSE POSITIVE",
    "risk_level": "Low",
    "confidence_score": 80,
    "key_findings": [],
    "risk_indicators": []
}
INFO:backend.predictions_backend:Using fallback analysis
INFO:routes.predictions_router:Analysis complete: TRUE POSITIVE
INFO:     127.0.0.1:57568 - "POST /predictions/analyze/initial?api_key=AIzaSyDL1Bg1Cpk7XUiPTp4O4bn4jb5VgISY9Lw HTTP/1.1" 200 OK




üìä Data preview: 5 rows loaded

‚ùå Analysis failed: 500 Server Error: Internal Server Error for url: http://localhost:8000/predictions/analyze/complete?api_key=AIzaSyDL1Bg1Cpk7XUiPTp4O4bn4jb5VgISY9Lw

üîç Debug Information

Upload Status:

{
"success":true
"total_rows":5
"columns":[
0:"Step"
1:"Name"
2:"Explanation"
3:"KQL Query"
4:"KQL Explanation"
5:"Execute"
6:"Output"
7:"Remarks/Comments"
]
"preview_data":[
0:{
"Step":NULL
"Name":"297"
"Explanation":NULL
"KQL Query":NULL
"KQL Explanation":NULL
"Execute":NULL
"Output":NULL
"Remarks/Comments":NULL
}
1:{
"Step":1
"Name":"Verify User Count Impacted"
"Explanation":"Gather details of all users - (By adding sheet to this excel)"
"KQL Query":"SigninLogs
| where UserPrincipalName == "<USER_EMAIL>"
| where TimeGenerated > ago(<TIMESPAN>)
| summarize SignInCount = count(), UniqueIPs = dcount(IPAddress), FailedAttempts = countif(ResultType != "0")
  by UserPrincipalName"
"KQL Explanation":"Queries sign-in activity, aggregates data."
"Execute":NULL
"Output":"UserPrincipalName	SignInCount	UniqueIPs	FailedAttempts
temp.user@abc.com	72	4	2
"
"Remarks/Comments":NULL
}
2:{
"Step":2
"Name":"Verify VIP User Accounts"
"Explanation":"Verify VIP user accounts by reviewing Access Control logs and login history. Confirm no unauthorized access or unusual activity detected"
"KQL Query":"SigninLogs
| where UserPrincipalName == "<USER_EMAIL>"
| where TimeGenerated > ago(<TIMESPAN>)
| summarize SignInCount = count(), UniqueIPs = dcount(IPAddress), FailedAttempts = countif(ResultType != "0")
  by UserPrincipalName"
"KQL Explanation":"Queries sign-in activity, aggregates data."
"Execute":NULL
"Output":"UserPrincipalName	SignInCount	UniqueIPs	FailedAttempts
temp.user@abc.com	72	4	2
"
"Remarks/Comments":NULL
}
3:{
"Step":3
"Name":"Verify IP/User/Time/Location"
"Explanation":"Review login event details (user account, IP address, time,  Geo location & User agent)
Analyze audit and signin logs to identify successful and failed attempts for last 7 days & device history."
"KQL Query":"SigninLogs
| where UserPrincipalName == "<USER_EMAIL>"
| where TimeGenerated > ago(<TIMESPAN>)
| summarize SignInCount = count(), UniqueIPs = dcount(IPAddress), FailedAttempts = countif(ResultType != "0")
  by UserPrincipalName"
"KQL Explanation":"Queries sign-in activity, aggregates data."
"Execute":NULL
"Output":"UserPrincipalName	SignInCount	UniqueIPs	FailedAttempts
temp.user@abc.com	72	4	2
"
"Remarks/Comments":NULL
}
4:{
"Step":4
"Name":"Verify IP Reputation Using VirusTotal"
"Explanation":"Check IP reputation using VirusTotal
If bad score, take a screenshot for documentation"
"KQL Query":NULL
"KQL Explanation":NULL
"Execute":NULL
"Output":"VirusTotal IP Reputation Check
    ==================================================

    IP Address: 8.8.8.8
    Reputation: [OK] CLEAN
    Risk Level: LOW

    Detection Results:
    ‚Ä¢ Malicious: 0/95
    ‚Ä¢ Suspicious: 0/95
    ‚Ä¢ Harmless: 62/95
    ‚Ä¢ Undetected: 33/95

    Network Details:
    ‚Ä¢ Country: US
    ‚Ä¢ ASN: 15169
    ‚Ä¢ Owner: GOOGLE

    Recommendation:
    [NO ACTION] IP appears clean. Continue with standard investigation.

    Verified: 2025-10-24 20:07:41
    VirusTotal URL: https://www.virustotal.com/gui/ip-address/8.8.8.8"
"Remarks/Comments":NULL
}
]
"timestamp":"2025-10-24T20:29:19.528609"
}
API Status:

{
"status":"healthy"
"timestamp":"2025-10-24T20:29:19.535587"
"analyzer_loaded":true
"data_loaded":true
"total_analyses":0
"cached_analyses":0
}
Testing Initial Analysis:

{
"success":true
"username":"temp.user@abc.com"
"classification":"TRUE POSITIVE"
"risk_level":"High"
"confidence_score":95
"summary":"Failed attempts or suspicious indicators detected"
"timestamp":"2025-10-24T20:29:20.962034"
}