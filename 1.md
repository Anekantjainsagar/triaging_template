INFO:backend.predictions_backend:Attempting to configure Gemini API...
INFO:backend.predictions_backend:Gemini API configured.
INFO:backend.predictions_backend:Attempting to initialize GenerativeModel...
INFO:backend.predictions_backend:GenerativeModel initialized.
‚úÖ Investigation Analyzer initialized with API key
INFO:     127.0.0.1:56729 - "POST /predictions/analyze/complete?api_key=AIzaSyDL1Bg1Cpk7XUiPTp4O4bn4jb5VgISY9Lw HTTP/1.1" 500 Internal Server 
Error
INFO:     127.0.0.1:56729 - "GET /predictions/upload/preview HTTP/1.1" 200 OK
INFO:     127.0.0.1:56729 - "GET /predictions/status HTTP/1.1" 200 OK
INFO:routes.predictions_router:============================================================
INFO:routes.predictions_router:ANALYZE INITIAL REQUEST: temp.user@abc.com
INFO:routes.predictions_router:Uploaded data shape: (5, 8)
INFO:routes.predictions_router:Uploaded data columns: ['Step', 'Name', 'Explanation', 'KQL Query', 'KQL Explanation', 'Execute', 'Output', 'Remarks/Comments']
INFO:backend.backed_fixes:============================================================
INFO:backend.backed_fixes:EXTRACTING STEPS FOR: temp.user@abc.com
INFO:backend.backed_fixes:Total rows in DataFrame: 5
INFO:backend.backed_fixes:Columns: ['Step', 'Name', 'Explanation', 'KQL Query', 'KQL Explanation', 'Execute', 'Output', 'Remarks/Comments']   
INFO:backend.backed_fixes:Row 0: SKIPPED (Header row - Step=None, Name=297)
INFO:backend.backed_fixes:Row 1: ‚úÖ Step 1 - Verify User Count Impacted (Output: 79ch, Remarks: 0ch)
INFO:backend.backed_fixes:Row 2: ‚úÖ Step 2 - Verify VIP User List (Output: 79ch, Remarks: 0ch)
INFO:backend.backed_fixes:Row 3: ‚úÖ Step 3 - Verify Login Event Details (Output: 79ch, Remarks: 0ch)
INFO:backend.backed_fixes:Row 4: ‚úÖ Step 4 - Verify IP Reputation Using VirusTotal (Output: 0ch, Remarks: 0ch)
INFO:backend.backed_fixes:============================================================
INFO:backend.backed_fixes:EXTRACTION COMPLETE: 4 steps extracted
INFO:routes.predictions_router:Extracted 4 steps
INFO:routes.predictions_router:First step: Verify User Count Impacted
INFO:watchfiles.main:4 changes detected
INFO:routes.predictions_router:First step output length: 79
INFO:backend.predictions_backend:Initial analysis for temp.user@abc.com
INFO:backend.predictions_backend:Total steps: 4
INFO:backend.predictions_backend:Steps with output: 3
INFO:backend.predictions_backend:Sending prompt to Gemini API...
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1761315895.589552   23976 alts_credentials.cc:93] ALTS creds ignored. Not running on GCP and untrusted ALTS is not enabled.
INFO:backend.predictions_backend:Gemini response length: 2025
INFO:backend.predictions_backend:Cleaned response preview: {
    "classification": "TRUE POSITIVE",
    "risk_level": "Medium",
    "confidence_score": 75,
    "key_findings": [
        {
            "step_reference": "Verify User Count Impacted",

INFO:backend.predictions_backend:‚úÖ JSON parsed successfully: TRUE POSITIVE
INFO:routes.predictions_router:Analysis complete: TRUE POSITIVE
INFO:     127.0.0.1:56729 - "POST /predictions/analyze/initial?api_key=AIzaSyDL1Bg1Cpk7XUiPTp4O4bn4jb5VgISY9Lw HTTP/1.1" 200 OK






üîç Debug Information

Upload Status:

{
"success":true
"total_rows":5
"columns":[
0:"Step"
1:"Name"
2:"Explanation"
3:"KQL Query"
4:"KQL Explanation"
5:"Execute"
6:"Output"
7:"Remarks/Comments"
]
"preview_data":[
0:{
"Step":NULL
"Name":"297"
"Explanation":NULL
"KQL Query":NULL
"KQL Explanation":NULL
"Execute":NULL
"Output":NULL
"Remarks/Comments":NULL
}
1:{
"Step":1
"Name":"Verify User Count Impacted"
"Explanation":"Gather details of all users - (By adding sheet to this excel)"
"KQL Query":"SigninLogs
| where UserPrincipalName == "<USER_EMAIL>"
| where TimeGenerated > ago(<TIMESPAN>)
| summarize SignInCount = count(), UniqueIPs = dcount(IPAddress), FailedAttempts = countif(ResultType != "0")
  by UserPrincipalName"
"KQL Explanation":"Queries sign-in activity, aggregates data."
"Execute":NULL
"Output":"UserPrincipalName	SignInCount	UniqueIPs	FailedAttempts
temp.user@abc.com	72	4	2
"
"Remarks/Comments":NULL
}
2:{
"Step":2
"Name":"Verify VIP User List"
"Explanation":"Verify VIP user list for access attempts in Authentication logs and Access Control logs. Check for unusual activity or unauthorized login attempts"
"KQL Query":"SigninLogs
| where UserPrincipalName == "<USER_EMAIL>"
| where TimeGenerated > ago(<TIMESPAN>)
| summarize SignInCount = count(), UniqueIPs = dcount(IPAddress), FailedAttempts = countif(ResultType != "0")
  by UserPrincipalName"
"KQL Explanation":"Queries sign-in activity, aggregates data."
"Execute":NULL
"Output":"UserPrincipalName	SignInCount	UniqueIPs	FailedAttempts
temp.user@abc.com	72	4	2
"
"Remarks/Comments":NULL
}
3:{
"Step":3
"Name":"Verify Login Event Details"
"Explanation":"Review login event details (user account, IP address, time,  Geo location & User agent)
Analyze audit and signin logs to identify successful and failed attempts for last 7 days & device history."
"KQL Query":"SigninLogs
| where UserPrincipalName == "<USER_EMAIL>"
| where TimeGenerated > ago(<TIMESPAN>)
| summarize SignInCount = count(), UniqueIPs = dcount(IPAddress), FailedAttempts = countif(ResultType != "0")
  by UserPrincipalName"
"KQL Explanation":"Queries sign-in activity, aggregates data."
"Execute":NULL
"Output":"UserPrincipalName	SignInCount	UniqueIPs	FailedAttempts
temp.user@abc.com	72	4	2
"
"Remarks/Comments":NULL
}
4:{
"Step":4
"Name":"Verify IP Reputation Using VirusTotal"
"Explanation":"Check IP reputation using VirusTotal
If bad score, take a screenshot for documentation"
"KQL Query":NULL
"KQL Explanation":NULL
"Execute":NULL
"Output":NULL
"Remarks/Comments":NULL
}
]
"timestamp":"2025-10-24T19:54:55.459564"
}
API Status:

{
"status":"healthy"
"timestamp":"2025-10-24T19:54:55.472005"
"analyzer_loaded":true
"data_loaded":true
"total_analyses":0
"cached_analyses":0
}
Testing Initial Analysis:

{
"success":true
"username":"temp.user@abc.com"
"classification":"TRUE POSITIVE"
"risk_level":"Medium"
"confidence_score":75
"summary":"User temp.user@abc.com has signed in 72 times with 4 unique IPs and 2 failed attempts."
"timestamp":"2025-10-24T19:55:02.332137"
}