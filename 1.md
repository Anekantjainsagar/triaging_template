1. VIP User Table Integration
2. Output Check at Each Step
3. Correlation of the Account with IP














   âœ… Generated 4 investigation steps
   âœ… Generated 4 investigation steps

ğŸ”„ PHASE 3: Merging with original template...
âœ… Investigation Step Merger initialized
âœ… Original steps (investigative): 0
âœ… Investigation Step Merger initialized

Merging investigation steps...
DEBUG: Original steps received: 0
DEBUG: Generated steps received: 4
Investigative (original): 0 steps
Duplicates found: 0
Unique new steps: 4
âœ… Final merged steps: 4

================================================================================
ğŸ“Š TEMPLATE MERGE REPORT
================================================================================

ğŸ“‹ ORIGINAL TEMPLATE:
Total steps: 0
Investigative steps: 0
Filtered out: 0 (remediation/closure steps)

ğŸ¤– AI GENERATED:
Total generated: 4
Duplicates: 0
Unique new steps: 4

âœ… FINAL MERGED TEMPLATE:
Total investigation steps: 4
From original: 0
Newly added: 4

ğŸ†• NEWLY ADDED STEPS:

1.  Check for impossible travel or unusual geographic login patterns for the user
    Priority: CRITICAL | Reason: Remote access analysis
2.  Analyze failed authentication attempts for password spray or brute force patterns against the user
    Priority: HIGH | Reason: Credential security
3.  Investigate concurrent active sessions or unusually long/short session durations for the user
    Priority: HIGH | Reason: Enhanced coverage
4.  Review recent application access and OAuth consent grants by the user for suspicious activity
    Priority: MEDIUM | Reason: Identity/Access analysis

================================================================================

âš™ï¸ PHASE 4: Generating KQL queries and finalizing...
Original steps: 0
AI-generated steps: 4

OK: Processing ORIGINAL steps (keeping all)...

OK: Kept all 0 ORIGINAL steps

OK: Processing AI-GENERATED steps (filtering if no KQL)...

      Step 1: Check for impossible travel or unusual geographic login patterns for the user
         Source: ai_generated | Priority: CRITICAL
         INFO: Generating KQL...

Query intent: geographic | Focus: location
âœ… Using hardcoded query (NO standardization needed)
OK: KQL generated (2024 chars)
INFO: Explanation: This query aggregates data, enriches fields, formats output, ranks results from ...

      Step 2: Analyze failed authentication attempts for password spray or brute force patterns against the user
         Source: ai_generated | Priority: HIGH
         INFO: Generating KQL...

Query intent: failed_signin | Focus: behavior
âœ… Using hardcoded query (NO standardization needed)
OK: KQL generated (1589 chars)
INFO: Explanation: This query aggregates data, enriches fields, formats output, ranks results from ...

      Step 3: Investigate concurrent active sessions or unusually long/short session durations for the user
         Source: ai_generated | Priority: HIGH
         INFO: Generating KQL...

âš ï¸ No specific intent match - using step name as fallback
Query intent: Investigate concurrent active sessions or unusually long/short session durations for the user | Focus: device
â„¹ï¸ No hardcoded query, attempting API fallback...
ğŸ”§ Standardizing API-generated query...

# ğŸ” KQL Validation & Standardization

âœ… Query passed validation
ğŸ“Š Primary table: SigninLogs
âœ… Query standardization complete

ğŸ” Validating for AuditLogs usage...
âœ… Query validation passed - no AuditLogs detected
âœ… Query standardized and validated
OK: KQL generated (351 chars)
INFO: Explanation: Queries SigninLogs table - with 7-day lookback from alert timestamp...

      Step 4: Review recent application access and OAuth consent grants by the user for suspicious activity
         Source: ai_generated | Priority: MEDIUM
         INFO: Generating KQL...

Query intent: role_permission | Focus: application
âœ… Using hardcoded query (NO standardization needed)
OK: KQL generated (3306 chars)
INFO: Explanation: This query aggregates data, enriches fields, formats output, ranks results from ...

OK: Processed 4 AI-GENERATED steps
NOTE: Skipped 0 AI-GENERATED steps (no KQL)

RESULT: Final template: 4 total steps - 0 from ORIGINAL - 4 from AI-GENERATED

INFO: Final KQL deduplication...
âœ… Removed 0 duplicate queries
âœ… Final template: 3 unique steps

================================================================================
âœ… COMPLETED in 39.4s: 4 investigation steps
================================================================================

================================================================================
INFO: KQL DATA INJECTION PHASE
================================================================================

================================================================================
ğŸ” ENTITY EXTRACTION DEBUG
================================================================================

ğŸ“… Extracting Reference DateTime...
âœ… Found timeGenerated in full_alert.properties: 2025-11-12T05:48:08.2503095Z
ğŸ“… Reference DateTime: 2025-11-12 05:48:08

ğŸ‘¥ Extracting Entities...
ğŸ“¦ Entities container type: <class 'dict'>
ğŸ“‹ Found entities.entities list: 5 items

ğŸ”¹ Entity 1: ACCOUNT
Properties keys: ['accountName', 'upnSuffix', 'friendlyName', 'userPrincipalName']
ğŸ‘¤ Account Details:
accountName: himanshu.s
upnSuffix: yashtechnologies841.onmicrosoft.com
friendlyName: Himanshu S
âœ… Added UPN: himanshu.s@yashtechnologies841.onmicrosoft.com

ğŸ”¹ Entity 2: IP
Properties keys: ['address']
ğŸŒ IP Details:
address: 14.143.131.254
âœ… Added IP: 14.143.131.254

ğŸ”¹ Entity 3: IP
Properties keys: ['address']
ğŸŒ IP Details:
address: 49.249.104.218
âœ… Added IP: 49.249.104.218

ğŸ”¹ Entity 4: CLOUDAPPLICATION
Properties keys: ['name', 'displayName']
â„¹ï¸ Unsupported entity type, skipping

ğŸ”¹ Entity 5: CLOUDAPPLICATION
Properties keys: ['name', 'displayName']
â„¹ï¸ Unsupported entity type, skipping

================================================================================
ğŸ“Š EXTRACTION SUMMARY
================================================================================
âœ… Users: 1
â€¢ himanshu.s@yashtechnologies841.onmicrosoft.com
âœ… IPs: 2
â€¢ 14.143.131.254
â€¢ 49.249.104.218
âœ… Hosts: 0
âœ… Reference DateTime: 2025-11-12 05:48:08
================================================================================

INFO: Extracted Entities:
Users: 1 - himanshu.s@yashtechnologies841.onmicrosoft.com
IPs: 2 - 14.143.131.254 - 49.249.104.218
Hosts: 0
Reference DateTime: 2025-11-12 05:48:08

================================================================================
ğŸ”„ TEMPLATE DATAFRAME INJECTION
================================================================================

ğŸ“‹ Template has 5 rows

ğŸ”¹ Step 1: Check for impossible travel or unusual geographic login patterns for the user

ğŸ”§ Processing KQL Query (2024 chars)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ”„ Converting ago() patterns to absolute datetimes...
âœ… Converted ago(30d) â†’ 2025-10-13 05:48:08 to 2025-11-12 05:48:08
(Looking back 30 days from alert time)
âœ… Converted 1 ago() pattern(s)

ğŸ‘¤ Injecting 1 user(s):
â€¢ himanshu.s@yashtechnologies841.onmicrosoft.com
âœ… Replaced 'where UserPrincipalName ==' pattern

ğŸŒ Injecting 2 IP(s):
â€¢ 14.143.131.254
â€¢ 49.249.104.218

ğŸ“Š Injection Summary:
Original length: 2024 chars
Final length: 2134 chars
Change: +5.4%
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Injection successful

ğŸ”¹ Step 2: Analyze failed authentication attempts for password spray or brute force patterns against the user

ğŸ”§ Processing KQL Query (1589 chars)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ”„ Converting ago() patterns to absolute datetimes...
âœ… Converted ago(7d) â†’ 2025-11-05 05:48:08 to 2025-11-12 05:48:08
(Looking back 7 days from alert time)
âœ… Converted 1 ago() pattern(s)

ğŸ‘¤ Injecting 1 user(s):
â€¢ himanshu.s@yashtechnologies841.onmicrosoft.com
âœ… Replaced 'where UserPrincipalName ==' pattern

ğŸŒ Injecting 2 IP(s):
â€¢ 14.143.131.254
â€¢ 49.249.104.218

ğŸ“Š Injection Summary:
Original length: 1589 chars
Final length: 1700 chars
Change: +7.0%
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Injection successful

ğŸ”¹ Step 3: Investigate concurrent active sessions or unusually long/short session durations for the user

ğŸ”§ Processing KQL Query (351 chars)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ”„ Converting ago() patterns to absolute datetimes...
âœ… Converted ago(7d) â†’ 2025-11-05 05:48:08 to 2025-11-12 05:48:08
(Looking back 7 days from alert time)
âœ… Converted 1 ago() pattern(s)

ğŸ‘¤ Injecting 1 user(s):
â€¢ himanshu.s@yashtechnologies841.onmicrosoft.com
âœ… Replaced 'where UserPrincipalName ==' pattern

ğŸŒ Injecting 2 IP(s):
â€¢ 14.143.131.254
â€¢ 49.249.104.218
âœ… Replaced 'where IPAddress ==' pattern

ğŸ“Š Injection Summary:
Original length: 351 chars
Final length: 484 chars
Change: +37.9%
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Injection successful

ğŸ”¹ Step 4: Review recent application access and OAuth consent grants by the user for suspicious activity

ğŸ”§ Processing KQL Query (3306 chars)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ”„ Converting ago() patterns to absolute datetimes...
âœ… Converted ago(30d) â†’ 2025-10-13 05:48:08 to 2025-11-12 05:48:08
(Looking back 30 days from alert time)
âœ… Converted 1 ago() pattern(s)

ğŸ‘¤ Injecting 1 user(s):
â€¢ himanshu.s@yashtechnologies841.onmicrosoft.com
âœ… Replaced 'where UserPrincipalName ==' pattern

ğŸŒ Injecting 2 IP(s):
â€¢ 14.143.131.254
â€¢ 49.249.104.218

ğŸ“Š Injection Summary:
Original length: 3306 chars
Final length: 3416 chars
Change: +3.3%
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Injection successful

================================================================================
ğŸ“Š INJECTION COMPLETE
================================================================================
âœ… Injected: 4 queries
â­ï¸ Skipped: 1 (no KQL)
âŒ Errors: 0
================================================================================

# OK: KQL Injection Complete!
