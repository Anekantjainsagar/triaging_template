INFO:backend.predictions_backend:Attempting to configure Gemini API...
INFO:backend.predictions_backend:Gemini API configured.
INFO:backend.predictions_backend:Attempting to initialize GenerativeModel...
INFO:backend.predictions_backend:GenerativeModel initialized.
‚úÖ Investigation Analyzer initialized with API key
INFO:     127.0.0.1:57485 - "POST /predictions/analyze/complete?api_key=AIzaSyDL1Bg1Cpk7XUiPTp4O4bn4jb5VgISY9Lw HTTP/1.1" 500 Internal Server 
Error
INFO:     127.0.0.1:57485 - "GET /predictions/upload/preview HTTP/1.1" 200 OK
INFO:     127.0.0.1:57485 - "GET /predictions/status HTTP/1.1" 200 OK
INFO:routes.predictions_router:============================================================
INFO:routes.predictions_router:ANALYZE INITIAL REQUEST: temp.user@abc.com
INFO:routes.predictions_router:Uploaded data shape: (5, 8)
INFO:routes.predictions_router:Uploaded data columns: ['Step', 'Name', 'Explanation', 'KQL Query', 'KQL Explanation', 'Execute', 'Output', 'Remarks/Comments']
INFO:backend.backed_fixes:============================================================
INFO:backend.backed_fixes:EXTRACTING STEPS FOR: temp.user@abc.com
INFO:backend.backed_fixes:Total rows in DataFrame: 5
INFO:backend.backed_fixes:Columns: ['Step', 'Name', 'Explanation', 'KQL Query', 'KQL Explanation', 'Execute', 'Output', 'Remarks/Comments']   
INFO:backend.backed_fixes:Row 0: SKIPPED (Header row - Step=None, Name=297)
INFO:backend.backed_fixes:Row 1: ‚úÖ Step 1 - Verify User Count Impacted (Output: 79ch, Remarks: 0ch)
INFO:backend.backed_fixes:Row 2: ‚úÖ Step 2 - Verify VIP User Accounts (Output: 79ch, Remarks: 0ch)
INFO:backend.backed_fixes:Row 3: ‚úÖ Step 3 - Verify IP/User/Time/Location (Output: 79ch, Remarks: 0ch)
INFO:backend.backed_fixes:Row 4: ‚úÖ Step 4 - Verify IP Reputation Using VirusTotal (Output: 547ch, Remarks: 0ch)
INFO:backend.backed_fixes:============================================================
INFO:backend.backed_fixes:EXTRACTION COMPLETE: 4 steps extracted
INFO:routes.predictions_router:Extracted 4 steps
INFO:routes.predictions_router:First step: Verify User Count Impacted
INFO:routes.predictions_router:First step output length: 79
INFO:backend.predictions_backend:Initial analysis for temp.user@abc.com
INFO:backend.predictions_backend:Total steps: 4
INFO:backend.predictions_backend:Steps with output: 4
INFO:backend.predictions_backend:Sending prompt to Gemini API...
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1761317620.249748   20300 alts_credentials.cc:93] ALTS creds ignored. Not running on GCP and untrusted ALTS is not enabled.
INFO:backend.predictions_backend:Gemini response length: 2483
INFO:backend.predictions_backend:Cleaned response preview: {\n  "classification": "FALSE POSITIVE",\n  "risk_level": "Low",\n  "confidence_score": 75,\n  "key_findings": [\n    {\n      "step_reference": "Verify User Count Impacted",\n      "category": "User
ERROR:backend.predictions_backend:JSON parse error: Expecting property name enclosed in double quotes: line 1 column 2 (char 1)
ERROR:backend.predictions_backend:Raw content: {
  "classification": "FALSE POSITIVE",
  "risk_level": "Low",
  "confidence_score": 75,
  "key_findings": [
    {
      "step_reference": "Verify User Count Impacted",
      "category": "User Account Activity",
      "severity": "Low",
      "details": "User temp.user@abc.com has 72 sign-ins, from 4 unique IPs, with 2 failed attempts.",
      "evidence": "UserPrincipalName\tSignInCount\tUniqueIPs\tFailedAttempts\ntemp.user@abc.com\t72\t4\t2",
      "impact": "Potentially normal user activity, requires further context."
    },
    {
      "step_reference": "Verify VIP User Accounts",
      "category": "Access Control",
      "severity": "Low",
      "details": "User temp.user@abc.com has 72 sign-ins, from 4 unique IPs, with 2 failed attempts. This information is duplicated from Step 
1.",
      "evidence": "UserPrincipalName\tSignInCount\tUniqueIPs\tFailedAttempts\ntemp.user@abc.com\t72\t4\t2",
      "impact": "Potentially normal user activity, requires further context."
    },
    {
      "step_reference": "Verify IP/User/Time/Location",
      "category": "Login Analysis",
      "severity": "Low",
      "details": "User temp.user@abc.com has 72 sign-ins, from 4 unique IPs, with 2 failed attempts. This information is duplicated from Step 
1 and 2.",
      "evidence": "UserPrincipalName\tSignInCount\tUniqueIPs\tFailedAttempts\ntemp.user@abc.com\t72\t4\t2",
      "impact": "Potentially normal user activity, requires further context."
    },
    {
      "step_reference": "Verify IP Reputation Using VirusTotal",
      "category": "IP Reputation",
      "severity": "Low",
      "details": "IP address 8.8.8.8 has a clean reputation according to VirusTotal.",
      "evidence": "VirusTotal IP Reputation Check\n==================================================\n\nIP Address: 8.8.8.8\nReputation: [OK] CLEAN\nRisk Level: LOW\n\nDetection Results:\n‚Ä¢ Malicious: 0/95\n‚Ä¢ Suspicious: 0/95\n‚Ä¢ Harmless: 62/95\n‚Ä¢ Undetected: 33/95\n\nNetwork Details:\n‚Ä¢ Country: US\n‚Ä¢ ASN: 15169\n‚Ä¢ Owner: GOOGLE",
      "impact": "Reduces risk associated with the IP address."
    }
  ],
  "risk_indicators": [
    {
      "indicator": "Multiple Sign-ins",
      "severity": "Low",
      "evidence": "72 sign-ins in the past 7 days.  Normal usage requires further context."
    },
    {
      "indicator": "Failed Login Attempts",
      "severity": "Low",
      "evidence": "2 failed login attempts.  Could be a mistype, requires further context if repeated."
    }
  ]
}
INFO:backend.predictions_backend:Using fallback analysis
INFO:routes.predictions_router:Analysis complete: TRUE POSITIVE
INFO:     127.0.0.1:57485 - "POST /predictions/analyze/initial?api_key=AIzaSyDL1Bg1Cpk7XUiPTp4O4bn4jb5VgISY9Lw HTTP/1.1" 200 OK









‚ùå Analysis failed: 500 Server Error: Internal Server Error for url: http://localhost:8000/predictions/analyze/complete?api_key=AIzaSyDL1Bg1Cpk7XUiPTp4O4bn4jb5VgISY9Lw

üîç Debug Information

Upload Status:

{
"success":true
"total_rows":5
"columns":[
0:"Step"
1:"Name"
2:"Explanation"
3:"KQL Query"
4:"KQL Explanation"
5:"Execute"
6:"Output"
7:"Remarks/Comments"
]
"preview_data":[
0:{
"Step":NULL
"Name":"297"
"Explanation":NULL
"KQL Query":NULL
"KQL Explanation":NULL
"Execute":NULL
"Output":NULL
"Remarks/Comments":NULL
}
1:{
"Step":1
"Name":"Verify User Count Impacted"
"Explanation":"Gather details of all users - (By adding sheet to this excel)"
"KQL Query":"SigninLogs
| where UserPrincipalName == "<USER_EMAIL>"
| where TimeGenerated > ago(<TIMESPAN>)
| summarize SignInCount = count(), UniqueIPs = dcount(IPAddress), FailedAttempts = countif(ResultType != "0")
  by UserPrincipalName"
"KQL Explanation":"Queries sign-in activity, aggregates data."
"Execute":NULL
"Output":"UserPrincipalName	SignInCount	UniqueIPs	FailedAttempts
temp.user@abc.com	72	4	2
"
"Remarks/Comments":NULL
}
2:{
"Step":2
"Name":"Verify VIP User Accounts"
"Explanation":"Verify VIP user accounts by reviewing Access Control logs and login history. Confirm no unauthorized access or unusual activity detected"
"KQL Query":"SigninLogs
| where UserPrincipalName == "<USER_EMAIL>"
| where TimeGenerated > ago(<TIMESPAN>)
| summarize SignInCount = count(), UniqueIPs = dcount(IPAddress), FailedAttempts = countif(ResultType != "0")
  by UserPrincipalName"
"KQL Explanation":"Queries sign-in activity, aggregates data."
"Execute":NULL
"Output":"UserPrincipalName	SignInCount	UniqueIPs	FailedAttempts
temp.user@abc.com	72	4	2
"
"Remarks/Comments":NULL
}
3:{
"Step":3
"Name":"Verify IP/User/Time/Location"
"Explanation":"Review login event details (user account, IP address, time,  Geo location & User agent)
Analyze audit and signin logs to identify successful and failed attempts for last 7 days & device history."
"KQL Query":"SigninLogs
| where UserPrincipalName == "<USER_EMAIL>"
| where TimeGenerated > ago(<TIMESPAN>)
| summarize SignInCount = count(), UniqueIPs = dcount(IPAddress), FailedAttempts = countif(ResultType != "0")
  by UserPrincipalName"
"KQL Explanation":"Queries sign-in activity, aggregates data."
"Execute":NULL
"Output":"UserPrincipalName	SignInCount	UniqueIPs	FailedAttempts
temp.user@abc.com	72	4	2
"
"Remarks/Comments":NULL
}
4:{
"Step":4
"Name":"Verify IP Reputation Using VirusTotal"
"Explanation":"Check IP reputation using VirusTotal
If bad score, take a screenshot for documentation"
"KQL Query":NULL
"KQL Explanation":NULL
"Execute":NULL
"Output":"VirusTotal IP Reputation Check
    ==================================================

    IP Address: 8.8.8.8
    Reputation: [OK] CLEAN
    Risk Level: LOW

    Detection Results:
    ‚Ä¢ Malicious: 0/95
    ‚Ä¢ Suspicious: 0/95
    ‚Ä¢ Harmless: 62/95
    ‚Ä¢ Undetected: 33/95

    Network Details:
    ‚Ä¢ Country: US
    ‚Ä¢ ASN: 15169
    ‚Ä¢ Owner: GOOGLE

    Recommendation:
    [NO ACTION] IP appears clean. Continue with standard investigation.

    Verified: 2025-10-24 20:07:41
    VirusTotal URL: https://www.virustotal.com/gui/ip-address/8.8.8.8"
"Remarks/Comments":NULL
}
]
"timestamp":"2025-10-24T20:23:40.140161"
}
API Status:

{
"status":"healthy"
"timestamp":"2025-10-24T20:23:40.150037"
"analyzer_loaded":true
"data_loaded":true
"total_analyses":0
"cached_analyses":0
}
Testing Initial Analysis:

{
"success":true
"username":"temp.user@abc.com"
"classification":"TRUE POSITIVE"
"risk_level":"High"
"confidence_score":95
"summary":"Failed attempts or suspicious indicators detected"
"timestamp":"2025-10-24T20:23:46.103560"
}