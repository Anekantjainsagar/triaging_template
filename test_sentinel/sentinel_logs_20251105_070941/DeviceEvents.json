[
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 352137,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 127082,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-05T06:55:01.802779Z",
    "TimeGenerated": "2025-11-05T06:55:01.802779Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T06:55:01.745095Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 351931,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126968,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-05T06:44:01.264935Z",
    "TimeGenerated": "2025-11-05T06:44:01.264935Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T06:44:01.20833Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 351916,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126962,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-05T06:44:00.352783Z",
    "TimeGenerated": "2025-11-05T06:44:00.352783Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T06:44:00.296157Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 351910,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126958,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-05T06:44:00.159602Z",
    "TimeGenerated": "2025-11-05T06:44:00.159602Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T06:44:00.102192Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n#set -e\n#\n# This file understands the following apt configuration variables:\n# Values here are the default.\n# Create /etc/apt/apt.conf.d/10periodic file to set your preference.\n#\n# All of the n-days interval options also accept the suffixes\n# s for seconds, m for minutes, h for hours, d for days or\n# the \"always\" value to do the action for every job run,\n# which can be used with systemd OnCalendar overrides to\n# define custom schedules for the apt update/upgrade jobs.\n#\n#  Dir \"/\";\n#  - RootDir for all configuration files\n#\n#  Dir::Cache \"var/cache/apt/\";\n#  - Set apt package cache directory\n#\n#  Dir::Cache::Archives \"archives/\";\n#  - Set package archive directory\n#\n#  APT::Periodic::Enable \"1\";\n#  - Enable the update/upgrade script (0=disable)\n#\n#  APT::Periodic::BackupArchiveInterval \"0\";\n#  - Backup after n-days if archive contents changed.(0=disable)\n#\n#  APT::Periodic::BackupLevel \"3\";\n#  - Backup level.(0=disable), 1 is invalid.\n#\n#  Dir::Cache::Backup \"backup/\";\n#  - Set periodic package backup directory\n#\n#  APT::Archives::MaxAge \"0\"; (old, deprecated)\n#  APT::Periodic::MaxAge \"0\"; (new)\n#  - Set maximum allowed age of a cache package file. If a cache \n#    package file is older it is deleted (0=disable)\n#\n#  APT::Archives::MinAge \"2\"; (old, deprecated)\n#  APT::Periodic::MinAge \"2\"; (new)\n#  - Set minimum age of a package file. If a file is younger it\n#    will not be deleted (0=disable). Useful to prevent races\n#    and to keep backups of the packages for emergency.\n#\n#  APT::Archives::MaxSize \"0\"; (old, deprecated)\n#  APT::Periodic::MaxSize \"0\"; (new)\n#  - Set maximum size of the cache in MB (0=disable). If the cache\n#    is bigger, cached package files are deleted until the size\n#    requirement is met (the oldest packages will be deleted \n#    first).\n#\n#  APT::Periodic::Update-Package-Lists \"0\";\n#  - Do \"apt-get update\" automatically every n-days (0=disable)\n#    \n#  APT::Periodic::Download-Upgradeable-Packages \"0\";\n#  - Do \"apt-get upgrade --download-only\" every n-days (0=disable)\n#\n#  APT::Periodic::Download-Upgradeable-Packages-Debdelta \"1\";\n#  - Use debdelta-upgrade to download updates if available (0=disable)\n#\n#  APT::Periodic::Unattended-Upgrade \"0\";\n#  - Run the \"unattended-upgrade\" security upgrade script \n#    every n-days (0=disabled)\n#    Requires the package \"unattended-upgrades\" and will write\n#    a log in /var/log/unattended-upgrades\n# \n#  APT::Periodic::AutocleanInterval \"0\";\n#  - Do \"apt-get autoclean\" every n-days (0=disable)\n#\n#  APT::Periodic::CleanInterval \"0\";\n#  - Do \"apt-get clean\" every n-days (0=disable)\n#\n#  APT::Periodic::Verbose \"0\";\n#  - Send report mail to root\n#      0:  no report             (or null string)\n#      1:  progress report       (actually any string)\n#      2:  + command outputs     (remove -qq, remove 2>/dev/null, add -d)\n#      3:  + trace on            \n#\n\ncheck_stamp()\n{\n    stamp=\"$1\"\n    interval=\"$2\"\n\n    if [ \"$interval\" = always ]; then\n\tdebug_echo \"check_stamp: ignoring time stamp file, interval set to always\"\n\t# treat as enough time has passed\n        return 0\n    fi\n\n    if [ \"$interval\" = 0 ]; then\n\tdebug_echo \"check_stamp: interval=0\"\n\t# treat as no time has passed\n        return 1\n    fi\n\n    if [ ! -f \"$stamp\" ]; then\n\tdebug_echo \"check_stamp: missing time stamp file: $stamp.\"\n\t# treat as enough time has passed\n        return 0\n    fi\n\n    # compare midnight today to midnight the day the stamp was updated\n    stamp_file=\"$stamp\"\n    stamp=$(date --date=\"$(date -r \"$stamp_file\" --iso-8601)\" +%s 2>/dev/null)\n    if [ \"$?\" != \"0\" ]; then\n        # Due to some timezones returning 'invalid date' for midnight on\n        # certain dates (e.g. America/Sao_Paulo), if date returns with error\n        # remove the stamp file and return 0. See coreutils bug:\n        # http://lists.gnu.org/archive/html/bug-coreutils/2007-09/msg00176.html\n        rm -f \"$stamp_file\"\n        return 0\n    fi\n\n    now=$(date --date=\"$(date --iso-8601)\" +%s 2>/dev/null)\n    if ["
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 351762,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126895,
    "SHA1": "",
    "SHA256": "4949c220a844071ee4709115aadfc00684578d5c7dda9c1b5a5c65a75de9d50f",
    "Timestamp": "2025-11-05T06:41:20.473438Z",
    "TimeGenerated": "2025-11-05T06:41:20.473438Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T06:41:20.418103Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 351736,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126883,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-05T06:40:09.381212Z",
    "TimeGenerated": "2025-11-05T06:40:09.381212Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T06:40:09.322951Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n\nset -e\n\n# Systemd systems use a systemd timer unit which is preferable to\n# run. We want to randomize the apt update and unattended-upgrade\n# runs as much as possible to avoid hitting the mirrors all at the\n# same time. The systemd time is better at this than the fixed\n# cron.daily time\nif [ -d /run/systemd/system ]; then\n    exit 0\nfi\n\ncheck_power()\n{\n    # laptop check, on_ac_power returns:\n    #       0 (true)    System is on main power\n    #       1 (false)   System is not on main power\n    #       255 (false) Power status could not be determined\n    # Desktop systems always return 255 it seems\n    if command -v on_ac_power >/dev/null; then\n        if on_ac_power; then\n            :\n        elif [ $? -eq 1 ]; then\n            return 1\n        fi\n    fi\n    return 0\n}\n\n# sleep for a random interval of time (default 30min)\n# (some code taken from cron-apt, thanks)\nrandom_sleep()\n{\n    RandomSleep=1800\n    eval $(apt-config shell RandomSleep APT::Periodic::RandomSleep)\n    if [ $RandomSleep -eq 0 ]; then\n\treturn\n    fi\n    if [ -z \"$RANDOM\" ] ; then\n        # A fix for shells that do not have this bash feature.\n\tRANDOM=$(( $(dd if=/dev/urandom bs=2 count=1 2> /dev/null | cksum | cut -d' ' -f1) % 32767 ))\n    fi\n    TIME=$(($RANDOM % $RandomSleep))\n    sleep $TIME\n}\n\n# delay the job execution by a random amount of time\nrandom_sleep\n\n# ensure we don't do this on battery\ncheck_power || exit 0\n\n# run daily job\nexec /usr/lib/apt/apt.systemd.daily\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 351572,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126849,
    "SHA1": "",
    "SHA256": "1983c659b042b1ec26127e7874954d83cd97eb8dcfd03238a7d2031ea0182fbe",
    "Timestamp": "2025-11-05T06:25:01.834724Z",
    "TimeGenerated": "2025-11-05T06:25:01.834724Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T06:25:01.701423Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh -e\n# clean all crash reports which are older than a week.\n[ -d /var/crash ] || exit 0\nfind /var/crash/. ! -name . -prune -type f \\( \\( -size 0 -a \\! -name '*.upload*' -a \\! -name '*.drkonqi*' \\) -o -mtime +7 \\) -exec rm -f -- '{}' \\;\nfind /var/crash/. ! -name . -prune -type d -regextype posix-extended -regex '.*/[0-9]{12}$' \\( -mtime +7 \\) -exec rm -Rf -- '{}' \\;\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 351562,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126841,
    "SHA1": "",
    "SHA256": "ece406240beddfd8d262a9f0f2ffd5aa40cae4bf5401e7641db3ae1aca737a39",
    "Timestamp": "2025-11-05T06:25:01.748047Z",
    "TimeGenerated": "2025-11-05T06:25:01.748047Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T06:25:01.690835Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 351515,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126828,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-05T06:22:00.063954Z",
    "TimeGenerated": "2025-11-05T06:22:00.063954Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T06:22:00.006959Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 351375,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126730,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-05T06:15:53.45204Z",
    "TimeGenerated": "2025-11-05T06:15:53.45204Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T06:15:53.395825Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 351189,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126713,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-05T05:55:01.677683Z",
    "TimeGenerated": "2025-11-05T05:55:01.677683Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T05:55:01.620883Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 350978,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126601,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-05T05:43:58.347459Z",
    "TimeGenerated": "2025-11-05T05:43:58.347459Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T05:43:58.290895Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 350963,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126595,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-05T05:43:57.548763Z",
    "TimeGenerated": "2025-11-05T05:43:57.548763Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T05:43:57.49218Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 350957,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126591,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-05T05:43:57.350409Z",
    "TimeGenerated": "2025-11-05T05:43:57.350409Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T05:43:57.293567Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 350909,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126586,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-05T05:40:09.380526Z",
    "TimeGenerated": "2025-11-05T05:40:09.380526Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T05:40:09.322471Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 350725,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126558,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-05T05:21:57.161171Z",
    "TimeGenerated": "2025-11-05T05:21:57.161171Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T05:21:57.103987Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 350574,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126456,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-05T05:15:26.784416Z",
    "TimeGenerated": "2025-11-05T05:15:26.784416Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T05:15:26.727571Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 350377,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126429,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-05T04:55:01.569969Z",
    "TimeGenerated": "2025-11-05T04:55:01.569969Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T04:55:01.513472Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 350153,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126308,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-05T04:43:55.462558Z",
    "TimeGenerated": "2025-11-05T04:43:55.462558Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T04:43:55.405977Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 350138,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126302,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-05T04:43:54.450639Z",
    "TimeGenerated": "2025-11-05T04:43:54.450639Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T04:43:54.393971Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 350132,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126298,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-05T04:43:54.26579Z",
    "TimeGenerated": "2025-11-05T04:43:54.26579Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T04:43:54.208999Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 349991,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126277,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-05T04:30:01.782285Z",
    "TimeGenerated": "2025-11-05T04:30:01.782285Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T04:30:01.724665Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 349883,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126249,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-05T04:21:54.360863Z",
    "TimeGenerated": "2025-11-05T04:21:54.360863Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T04:21:54.303378Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 349722,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126139,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-05T04:14:59.855402Z",
    "TimeGenerated": "2025-11-05T04:14:59.855402Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T04:14:59.799954Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 349517,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 126102,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-05T03:55:01.461949Z",
    "TimeGenerated": "2025-11-05T03:55:01.461949Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T03:55:01.406214Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 349276,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 125962,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-05T03:43:52.363368Z",
    "TimeGenerated": "2025-11-05T03:43:52.363368Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T03:43:52.306741Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 349260,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 125955,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-05T03:43:51.353993Z",
    "TimeGenerated": "2025-11-05T03:43:51.353993Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T03:43:51.297436Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 349254,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 125951,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-05T03:43:51.153716Z",
    "TimeGenerated": "2025-11-05T03:43:51.153716Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T03:43:51.0961Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 349081,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 125903,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-05T03:30:00.814885Z",
    "TimeGenerated": "2025-11-05T03:30:00.814885Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T03:30:00.758885Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 348953,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 125859,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-05T03:21:51.563133Z",
    "TimeGenerated": "2025-11-05T03:21:51.563133Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T03:21:51.505603Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 348783,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 125744,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-05T03:14:33.563886Z",
    "TimeGenerated": "2025-11-05T03:14:33.563886Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T03:14:33.50739Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 348307,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 125522,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-05T02:45:01.323755Z",
    "TimeGenerated": "2025-11-05T02:45:01.323755Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T02:45:01.265872Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 348269,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 125504,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-05T02:43:49.15608Z",
    "TimeGenerated": "2025-11-05T02:43:49.15608Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T02:43:49.099644Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 348253,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 125497,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-05T02:43:48.247654Z",
    "TimeGenerated": "2025-11-05T02:43:48.247654Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T02:43:48.190842Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 348247,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 125493,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-05T02:43:48.047808Z",
    "TimeGenerated": "2025-11-05T02:43:48.047808Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T02:43:47.991079Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 345734,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 124418,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-05T02:30:00.439856Z",
    "TimeGenerated": "2025-11-05T02:30:00.439856Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T02:30:00.378322Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3\n# -*- coding: utf-8 -*-\n\"\"\"Process new requests to download per-package data\"\"\"\n# Copyright (C) 2012 Canonical Ltd\n#\n# This program is free software; you can redistribute it and/or modify\n# it under the terms of version 3 of the GNU General Public License as\n# published by the Free Software Foundation.\n#\n# This program is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License along\n# with this program; if not, write to the Free Software Foundation, Inc.,\n# 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.\n\nimport glob\nimport os\nimport sys\nimport subprocess\nimport traceback\nimport debian.deb822\nimport string\nimport debconf\nfrom datetime import datetime\n\nimport apt_pkg\n\n# avoid hanging forever (LP: #1243090)\nimport socket\nsocket.setdefaulttimeout(60)\n\n\nDATADIR = \"/usr/share/package-data-downloads/\"\nSTAMPDIR = \"/var/lib/update-notifier/package-data-downloads/\"\nNOTIFIER_SOURCE_FILE = \\\n    \"/usr/share/update-notifier/package-data-downloads-failed\"\nNOTIFIER_FILE = \"/var/lib/update-notifier/user.d/data-downloads-failed\"\nNOTIFIER_PERMANENT_SOURCE_FILE = NOTIFIER_SOURCE_FILE + '-permanently'\nNOTIFIER_PERMANENT_FILE = NOTIFIER_FILE + '-permanently'\n\nfailures = []\npermanent_failures = []\n\n\ndef create_or_update_stampfile(file):\n    \"\"\"Create or update the indicated stampfile, and remove failure flags\"\"\"\n\n    try:\n        with open(file, 'w'):\n            pass\n    # Ignore errors\n    except Exception:\n        traceback.print_exc(file=sys.stderr)\n\n    os.utime(file, None)\n\n    for ext in ('.failed', '.permanent-failure'):\n        if os.path.exists(file + ext):\n            os.unlink(file + ext)\n\n\ndef mark_hook_failed(hook_name, permanent=False):\n    \"\"\"Create a stampfile recording that a hook failed\n\n    We create separate stampfiles for failed hooks so we can\n    keep track of how long the hook has been failing and if the failure\n    should be considered permanent.\"\"\"\n\n    if permanent:\n        filename = hook_name + '.permanent-failure'\n    else:\n        filename = hook_name + '.failed'\n\n    failure_file = os.path.join(STAMPDIR, filename)\n    try:\n        with open(failure_file, 'w'):\n            pass\n\n    # Ignore errors\n    except Exception:\n        traceback.print_exc(file=sys.stderr)\n\n    for ext in ('', '.failed', '.permanent-failure'):\n        stampfile = hook_name + ext\n        if filename != stampfile \\\n           and os.path.exists(os.path.join(STAMPDIR, stampfile)):\n            os.unlink(os.path.join(STAMPDIR, stampfile))\n\n\ndef hook_is_permanently_failed(hook_name):\n    \"\"\"Check if this hook has been marked as permanently failing.\n\n    If so, don't raise any more errors about it.\"\"\"\n\n    failure_file = os.path.join(STAMPDIR, hook_name + '.permanent-failure')\n    return os.path.exists(failure_file)\n\n\ndef hook_aged_out(hook_name):\n    \"\"\"Check if this hook has been failing consistently for >= 3 days\"\"\"\n\n    failure_file = os.path.join(STAMPDIR, hook_name + '.failed')\n    try:\n        hook_date = datetime.fromtimestamp(os.stat(failure_file).st_ctime)\n        cur_time = datetime.now()\n        d = cur_time - hook_date\n        if d.days >= 3:\n            return True\n    except OSError:\n        pass\n    except Exception:\n        traceback.print_exc(file=sys.stderr)\n    return False\n\n\ndef record_failure(hook):\n    \"\"\"Record that the named hook has failed\"\"\"\n    if hook_aged_out(hook):\n        permanent_failures.append(hook)\n    else:\n        failures.append(hook)\n\n\ndef existing_permanent_failures():\n    \"\"\"Return the list of all previously recorded permanent failures\"\"\"\n\n    files = glob.glob(os.path.join(STAMPDIR, \"*.permanent-failure\"))\n    return [os.path.splitext(os.path.basename(path))[0] for path in files]\n\n\ndef trigger_update_notifier(failures, permanent=False):\n    "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 345707,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 124413,
    "SHA1": "",
    "SHA256": "391e6221124df1be64aa64dc84e094dffd2165f6a708ee1db29aabffa0559aaf",
    "Timestamp": "2025-11-05T02:27:39.242126Z",
    "TimeGenerated": "2025-11-05T02:27:39.242126Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T02:27:39.185476Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 345610,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 124397,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-05T02:21:48.66451Z",
    "TimeGenerated": "2025-11-05T02:21:48.66451Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T02:21:48.607048Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# This script is called by \"systemctl enable/disable\" when the given unit is a\n# SysV init.d script. It needs to call the distribution's mechanism for\n# enabling/disabling those, such as chkconfig, update-rc.d, or similar. This\n# can optionally take a --root argument for enabling a SysV init script\n# in a chroot or similar.\nset -eu\n\nusage() {\n    echo \"Usage: $0 [--root=path] enable|disable|is-enabled <sysv script name>\" >&2\n    exit 1\n}\n\nROOT=\n\n# parse options\neval set -- \"$(getopt -o r: --long root: -- \"$@\")\"\nwhile true; do\n    case \"$1\" in\n        -r|--root)\n            ROOT=\"$2\"\n            shift 2 ;;\n        --) shift ; break ;;\n        *) usage ;;\n    esac\ndone\n\nNAME=\"${2:-}\"\n\nrun() {\n    if [ -n \"$ROOT\" ] && [ \"$ROOT\" != \"/\" ]; then\n        _SKIP_SYSTEMD_NATIVE=1 chroot \"$ROOT\" /usr/sbin/update-rc.d \"$@\"\n    else\n        _SKIP_SYSTEMD_NATIVE=1 /usr/sbin/update-rc.d \"$@\"\n    fi\n}\n\n[ -n \"$NAME\" ] || usage\n\ncase \"$1\" in\n    enable)\n        # call the command to enable SysV init script $NAME here..\n        run \"$NAME\" defaults\n        run \"$NAME\" enable\n        ;;\n    disable)\n        run \"$NAME\" defaults\n        run \"$NAME\" disable\n        ;;\n    is-enabled)\n        # exit with 0 if $NAME is enabled, non-zero if it is disabled\n        ls \"$ROOT\"/etc/rc[S5].d/S??\"$NAME\" >/dev/null 2>&1\n        ;;\n    *)\n        usage ;;\nesac\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 345277,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 124344,
    "SHA1": "",
    "SHA256": "dba758ee9a9c9a5c76047b275ce6215c8f669cc7689548e9ac8ff32a9513eff4",
    "Timestamp": "2025-11-05T02:20:15.002796Z",
    "TimeGenerated": "2025-11-05T02:20:15.002796Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T02:20:14.946141Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 345032,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 124213,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-05T02:14:07.082411Z",
    "TimeGenerated": "2025-11-05T02:14:07.082411Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T02:14:07.026243Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 344694,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 124105,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-05T01:45:01.215462Z",
    "TimeGenerated": "2025-11-05T01:45:01.215462Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T01:45:01.15957Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 344643,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 124093,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-05T01:43:44.536071Z",
    "TimeGenerated": "2025-11-05T01:43:44.536071Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T01:43:44.406521Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 344638,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 124090,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-05T01:43:44.254596Z",
    "TimeGenerated": "2025-11-05T01:43:44.254596Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T01:43:44.197892Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 344631,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 124086,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-05T01:43:44.047914Z",
    "TimeGenerated": "2025-11-05T01:43:44.047914Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T01:43:43.991262Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 344426,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 124073,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-05T01:21:45.863917Z",
    "TimeGenerated": "2025-11-05T01:21:45.863917Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T01:21:45.806087Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 344409,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 124070,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-05T01:20:09.377677Z",
    "TimeGenerated": "2025-11-05T01:20:09.377677Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T01:20:09.322394Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 344266,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123972,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-05T01:13:42.070097Z",
    "TimeGenerated": "2025-11-05T01:13:42.070097Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T01:13:42.014702Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 343915,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123855,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-05T00:45:01.106706Z",
    "TimeGenerated": "2025-11-05T00:45:01.106706Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T00:45:01.050705Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 343887,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123848,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-05T00:43:42.172368Z",
    "TimeGenerated": "2025-11-05T00:43:42.172368Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T00:43:42.114606Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 343874,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123843,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-05T00:43:41.235759Z",
    "TimeGenerated": "2025-11-05T00:43:41.235759Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T00:43:41.105246Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 343869,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123840,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-05T00:43:40.956903Z",
    "TimeGenerated": "2025-11-05T00:43:40.956903Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T00:43:40.89939Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3\n# EASY-INSTALL-ENTRY-SCRIPT: 'cloud-init==25.1.4','console_scripts','cloud-id'\nimport re\nimport sys\n\n# for compatibility with easy_install; see #2198\n__requires__ = 'cloud-init==25.1.4'\n\ntry:\n    from importlib.metadata import distribution\nexcept ImportError:\n    try:\n        from importlib_metadata import distribution\n    except ImportError:\n        from pkg_resources import load_entry_point\n\n\ndef importlib_load_entry_point(spec, group, name):\n    dist_name, _, _ = spec.partition('==')\n    matches = (\n        entry_point\n        for entry_point in distribution(dist_name).entry_points\n        if entry_point.group == group and entry_point.name == name\n    )\n    return next(matches).load()\n\n\nglobals().setdefault('load_entry_point', importlib_load_entry_point)\n\n\nif __name__ == '__main__':\n    sys.argv[0] = re.sub(r'(-script\\.pyw?|\\.exe)?$', '', sys.argv[0])\n    sys.exit(load_entry_point('cloud-init==25.1.4', 'console_scripts', 'cloud-id')())\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 343720,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123818,
    "SHA1": "",
    "SHA256": "c0915e3098511b7afe1d2e929818a4026c0d414a0b330ed671bc75a0d8af2c1e",
    "Timestamp": "2025-11-05T00:31:09.442102Z",
    "TimeGenerated": "2025-11-05T00:31:09.442102Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T00:31:09.359778Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n#\n#    50-motd-news - print the live news from the Ubuntu wire\n#    Copyright (C) 2016-2020 Canonical Ltd.\n#    Copyright (C) 2016-2017 Dustin Kirkland\n#\n#    Authors: Dustin Kirkland <kirkland@canonical.com>\n#             Steve Langasek <steve.langasek@canonical.com>\n#\n#    This program is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; either version 2 of the License, or\n#    (at your option) any later version.\n#\n#    This program is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n#\n#    You should have received a copy of the GNU General Public License along\n#    with this program; if not, write to the Free Software Foundation, Inc.,\n#    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.\n\n##############################################################################\n# This program could be rewritten in C or Golang for faster performance.\n# Or it could be rewritten in Python or another higher level language\n# for more modularity.\n# However, I've insisted on shell here for transparency!\n#                                                                     - Dustin\n##############################################################################\n\n# Source the local configuration\n[ -r /etc/default/motd-news ] && . /etc/default/motd-news\n\n# Exit immediately, unless we're enabled\n# This makes this script very easy to disable in /etc/default/motd-news configuration\n[ \"$ENABLED\" = \"1\" ] || exit 0\n\n# Ensure sane defaults\n[ -n \"$URLS\" ] || URLS=\"https://motd.ubuntu.com\"\n[ -n \"$WAIT\" ] || WAIT=5\n[ -n \"$CACHE\" ] || CACHE=\"/var/cache/motd-news\"\n[ \"$1\" = \"--force\" ] && FORCED=1\n\n# Ensure we print safely, maximum of the first 10 lines,\n# maximum of the first 80 chars per line, no control chars\nsafe_print() {\n\tcat \"$1\" | head -n 10 | tr -d '\\000-\\011\\013\\014\\016-\\037' | cut -c -80\n}\n\n\n# If we're not forcing an update, and we have a cached motd-news file,\n# then just print it and exit as quickly as possible, for login performance.\n# Note that systemd should keep this cache file up to date, asynchronously\nif [ \"$FORCED\" != \"1\" ]; then\n  \tif [ -r $CACHE ]; then\n\t\techo\n\t\tsafe_print $CACHE\n\telif [ \"$(id -u)\" -eq 0 ]; then\n\t\t: > $CACHE\n\tfi\n\texit 0\nfi\n\n# If we've made it here, we've been given the --force argument,\n# probably from the systemd motd-news.service.  Let's update...\n\n# Abort early if wget is missing\n[ -x /usr/bin/wget ] || exit 0\n\n# Generate our temp files, clean up when done\nNEWS=$(mktemp) || exit 1\nERR=$(mktemp) || exit 1\nCLOUD=$(mktemp) || exit 1\ntrap \"rm -f $NEWS $ERR $CLOUD\" HUP INT QUIT ILL TRAP KILL BUS TERM\n\n# Construct a user agent, similar to Firefox/Chrome/Safari/IE to\n# ensure a proper, tailored, accurate message of the day\n\n# wget browser version, for debug purposes\nwget_ver=\"$(dpkg -l wget | awk '$1 == \"ii\" { print($3); exit(0); }')\"\n\n# Distribution version, for messages releated to this Ubuntu release\n. /etc/lsb-release\nlsb=$(echo \"$DISTRIB_DESCRIPTION\" | sed -e \"s/ /\\//g\")\ncodename=\"$DISTRIB_CODENAME\"\n\n# Kernel version and CPU type, for messages related to a particular revision or hardware\nplatform=\"$(uname -o)/$(uname -r)/$(uname -m)\"\narch=\"$(uname -m)\"\ncpu=\"$(grep -m1 \"^model name\" /proc/cpuinfo | sed -e \"s/.*: //\" -e \"s:\\s\\+:/:g\")\"\ncloud_id=\"unknown\"\nif [ -x /usr/bin/cloud-id ]; then\n    /usr/bin/cloud-id > \"$CLOUD\" 2>/dev/null\n    if [ \"$?\" -eq \"0\" ]; then\n        # sanitize it a bit, just in case\n        cloud_id=$(cut -c -40 \"${CLOUD}\" | tr -c -d '[:alnum:]')\n        if [ -z \"${cloud_id}\" ]; then\n            cloud_id=\"unknown\"\n        fi\n    fi\nfi\n\n# Piece together the user agent\nUSER_AGENT=\"wget/$wget_ver $lsb $platform $cpu cloud_id/$cloud_id\"\n\n# Loop over any configured URLs\nfor u in $URLS; do\n\t# Ensu"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 343687,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123792,
    "SHA1": "",
    "SHA256": "12d09f922c013d07b62cca4fda15a567d94133b196c23193784f1725562ad754",
    "Timestamp": "2025-11-05T00:31:09.377108Z",
    "TimeGenerated": "2025-11-05T00:31:09.377108Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T00:31:09.3204Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n#set -e\n#\n# This file understands the following apt configuration variables:\n# Values here are the default.\n# Create /etc/apt/apt.conf.d/10periodic file to set your preference.\n#\n# All of the n-days interval options also accept the suffixes\n# s for seconds, m for minutes, h for hours, d for days or\n# the \"always\" value to do the action for every job run,\n# which can be used with systemd OnCalendar overrides to\n# define custom schedules for the apt update/upgrade jobs.\n#\n#  Dir \"/\";\n#  - RootDir for all configuration files\n#\n#  Dir::Cache \"var/cache/apt/\";\n#  - Set apt package cache directory\n#\n#  Dir::Cache::Archives \"archives/\";\n#  - Set package archive directory\n#\n#  APT::Periodic::Enable \"1\";\n#  - Enable the update/upgrade script (0=disable)\n#\n#  APT::Periodic::BackupArchiveInterval \"0\";\n#  - Backup after n-days if archive contents changed.(0=disable)\n#\n#  APT::Periodic::BackupLevel \"3\";\n#  - Backup level.(0=disable), 1 is invalid.\n#\n#  Dir::Cache::Backup \"backup/\";\n#  - Set periodic package backup directory\n#\n#  APT::Archives::MaxAge \"0\"; (old, deprecated)\n#  APT::Periodic::MaxAge \"0\"; (new)\n#  - Set maximum allowed age of a cache package file. If a cache \n#    package file is older it is deleted (0=disable)\n#\n#  APT::Archives::MinAge \"2\"; (old, deprecated)\n#  APT::Periodic::MinAge \"2\"; (new)\n#  - Set minimum age of a package file. If a file is younger it\n#    will not be deleted (0=disable). Useful to prevent races\n#    and to keep backups of the packages for emergency.\n#\n#  APT::Archives::MaxSize \"0\"; (old, deprecated)\n#  APT::Periodic::MaxSize \"0\"; (new)\n#  - Set maximum size of the cache in MB (0=disable). If the cache\n#    is bigger, cached package files are deleted until the size\n#    requirement is met (the oldest packages will be deleted \n#    first).\n#\n#  APT::Periodic::Update-Package-Lists \"0\";\n#  - Do \"apt-get update\" automatically every n-days (0=disable)\n#    \n#  APT::Periodic::Download-Upgradeable-Packages \"0\";\n#  - Do \"apt-get upgrade --download-only\" every n-days (0=disable)\n#\n#  APT::Periodic::Download-Upgradeable-Packages-Debdelta \"1\";\n#  - Use debdelta-upgrade to download updates if available (0=disable)\n#\n#  APT::Periodic::Unattended-Upgrade \"0\";\n#  - Run the \"unattended-upgrade\" security upgrade script \n#    every n-days (0=disabled)\n#    Requires the package \"unattended-upgrades\" and will write\n#    a log in /var/log/unattended-upgrades\n# \n#  APT::Periodic::AutocleanInterval \"0\";\n#  - Do \"apt-get autoclean\" every n-days (0=disable)\n#\n#  APT::Periodic::CleanInterval \"0\";\n#  - Do \"apt-get clean\" every n-days (0=disable)\n#\n#  APT::Periodic::Verbose \"0\";\n#  - Send report mail to root\n#      0:  no report             (or null string)\n#      1:  progress report       (actually any string)\n#      2:  + command outputs     (remove -qq, remove 2>/dev/null, add -d)\n#      3:  + trace on            \n#\n\ncheck_stamp()\n{\n    stamp=\"$1\"\n    interval=\"$2\"\n\n    if [ \"$interval\" = always ]; then\n\tdebug_echo \"check_stamp: ignoring time stamp file, interval set to always\"\n\t# treat as enough time has passed\n        return 0\n    fi\n\n    if [ \"$interval\" = 0 ]; then\n\tdebug_echo \"check_stamp: interval=0\"\n\t# treat as no time has passed\n        return 1\n    fi\n\n    if [ ! -f \"$stamp\" ]; then\n\tdebug_echo \"check_stamp: missing time stamp file: $stamp.\"\n\t# treat as enough time has passed\n        return 0\n    fi\n\n    # compare midnight today to midnight the day the stamp was updated\n    stamp_file=\"$stamp\"\n    stamp=$(date --date=\"$(date -r \"$stamp_file\" --iso-8601)\" +%s 2>/dev/null)\n    if [ \"$?\" != \"0\" ]; then\n        # Due to some timezones returning 'invalid date' for midnight on\n        # certain dates (e.g. America/Sao_Paulo), if date returns with error\n        # remove the stamp file and return 0. See coreutils bug:\n        # http://lists.gnu.org/archive/html/bug-coreutils/2007-09/msg00176.html\n        rm -f \"$stamp_file\"\n        return 0\n    fi\n\n    now=$(date --date=\"$(date --iso-8601)\" +%s 2>/dev/null)\n    if ["
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 343544,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123728,
    "SHA1": "",
    "SHA256": "4949c220a844071ee4709115aadfc00684578d5c7dda9c1b5a5c65a75de9d50f",
    "Timestamp": "2025-11-05T00:28:09.414422Z",
    "TimeGenerated": "2025-11-05T00:28:09.414422Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T00:28:09.359091Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 343461,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123716,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-05T00:21:43.263834Z",
    "TimeGenerated": "2025-11-05T00:21:43.263834Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T00:21:43.205247Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 343306,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123618,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-05T00:13:17.30724Z",
    "TimeGenerated": "2025-11-05T00:13:17.30724Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T00:13:17.251145Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\nexec grep -E \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 343219,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123600,
    "SHA1": "",
    "SHA256": "f7c621ae0ceb26a76802743830bc469288996f64342901ae5292950ff713e981",
    "Timestamp": "2025-11-05T00:07:01.821818Z",
    "TimeGenerated": "2025-11-05T00:07:01.821818Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T00:07:01.764248Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa2\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa2: Write a daily report\n#\nS_TIME_FORMAT=ISO ; export S_TIME_FORMAT\nprefix=/usr\nexec_prefix=${prefix}\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nHISTORY=7\nCOMPRESSAFTER=10\nZIP=\"xz\"\nUMASK=0022\nENDIR=\nDELAY_RANGE=0\n\n# Read configuration file, overriding variables set above\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# Wait for a random delay if requested\nif [ ${DELAY_RANGE} -gt 0 ]\nthen\n\tRANDOM=$$\n\tDELAY=$((${RANDOM}%${DELAY_RANGE}))\n\tsleep ${DELAY}\nfi\n\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n\n# if YESTERDAY=no then today's summary is generated\nif [ x$YESTERDAY = xno ]\nthen\n\tDATE_OPTS=\nelse\n\tDATE_OPTS=\"--date=yesterday\"\nfi\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tDATE=`date ${DATE_OPTS} +%Y%m%d`\nelse\n\tDATE=`date ${DATE_OPTS} +%d`\nfi\nCURRENTFILE=sa${DATE}\nCURRENTRPT=sar${DATE}\n\nRPT=${SA_DIR}/${CURRENTRPT}\nDFILE=${SA_DIR}/${CURRENTFILE}\nif [ -z \"${ENDIR}\" ];\nthen\n       ENDIR=${exec_prefix}/bin\nfi\n\n[ -f \"${DFILE}\" ] || exit 0\ncd ${ENDIR}\nif [ x${REPORTS} != xfalse ]\nthen\n\t${ENDIR}/sar.sysstat \"$@\" -f ${DFILE} > ${RPT}\nfi\n\nSAFILES_REGEX='/sar?[0-9]{2,8}(\\.(Z|gz|bz2|xz|lz|lzo))?$'\n\nfind \"${SA_DIR}\" -type f -mtime +${HISTORY} \\\n\t| egrep \"${SAFILES_REGEX}\" \\\n\t| xargs   rm -f\n\nUNCOMPRESSED_SAFILES_REGEX='/sar?[0-9]{2,8}$'\n\nfind \"${SA_DIR}\" -type f -mtime +${COMPRESSAFTER} \\\n\t| egrep \"${UNCOMPRESSED_SAFILES_REGEX}\" \\\n\t| xargs -r \"${ZIP}\" > /dev/null\n\nexit 0\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 343207,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123588,
    "SHA1": "",
    "SHA256": "5b0cb84ff7cfa614f8a034e136afbea03a0edb347a59ba78e42206b1bed3e654",
    "Timestamp": "2025-11-05T00:07:01.709948Z",
    "TimeGenerated": "2025-11-05T00:07:01.709948Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T00:07:01.654133Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 343119,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123575,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-05T00:00:00.553906Z",
    "TimeGenerated": "2025-11-05T00:00:00.553906Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T00:00:00.494218Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n#\n# Copyright  2014, 2017-2018, 2020-2021 Guillem Jover <guillem@debian.org>\n#\n# This program is free software; you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation; either version 2 of the License, or\n# (at your option) any later version.\n#\n# This program is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nADMINDIR='/var/lib/dpkg'\nBACKUPSDIR='/var/backups'\nROTATE=7\n\nwhile [ $# -ne 0 ]; do\n  case \"$1\" in\n  --rotate=*)\n    ROTATE=\"${1#--rotate=}\"\n    ;;\n  esac\n  shift\ndone\n\ndbdir=\"$ADMINDIR\"\n\n# Backup the N last versions of dpkg databases containing user data.\nif cd $BACKUPSDIR ; then\n  # We backup all relevant database files if any has changed, so that\n  # the rotation number always contains an internally consistent set.\n  dbchanged=no\n  dbfiles=\"arch status diversions statoverride\"\n  for db in $dbfiles ; do\n    if ! [ -s \"dpkg.${db}.0\" ] && ! [ -s \"$dbdir/$db\" ]; then\n      # Special case the files not existing or being empty as being equal.\n      continue\n    elif ! cmp -s \"dpkg.${db}.0\" \"$dbdir/$db\"; then\n      dbchanged=yes\n      break\n    fi\n  done\n  if [ \"$dbchanged\" = \"yes\" ] ; then\n    for db in $dbfiles ; do\n      if [ -e \"$dbdir/$db\" ]; then\n        cp -p \"********** \"dpkg.$db\"\n      else\n        touch \"dpkg.$db\"\n      fi\n      savelog -c \"$ROTATE\" \"dpkg.$db\" >/dev/null\n    done\n  fi\n\n  # The alternatives database is independent from the dpkg database.\n  dbalt=alternatives\n\n  # XXX: Ideally we'd use --warning=none instead of discarding stderr, but\n  # as of GNU tar 1.27.1, it does not seem to work reliably (see #749307).\n  if ! test -e ${dbalt}.tar.0 ||\n     ! tar -df ${dbalt}.tar.0 -C $dbdir $dbalt >/dev/null 2>&1 ;\n  then\n    tar -cf ${dbalt}.tar -C $dbdir $dbalt >/dev/null 2>&1\n    savelog -c \"$ROTATE\" ${dbalt}.tar >/dev/null\n  fi\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 343117,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123565,
    "SHA1": "",
    "SHA256": "a2b4ce22b54ee837e400915bf3b6c971cd6848d4b79990f09cf314b8d38a1e0e",
    "Timestamp": "2025-11-05T00:00:00.529457Z",
    "TimeGenerated": "2025-11-05T00:00:00.529457Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-05T00:00:00.472789Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 342882,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123457,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-04T23:43:40.751971Z",
    "TimeGenerated": "2025-11-04T23:43:40.751971Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T23:43:40.695736Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 342877,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123454,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-04T23:43:40.537502Z",
    "TimeGenerated": "2025-11-04T23:43:40.537502Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T23:43:40.396018Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 342858,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123448,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-04T23:43:38.664147Z",
    "TimeGenerated": "2025-11-04T23:43:38.664147Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T23:43:38.607767Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 342672,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123432,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-04T23:25:01.957973Z",
    "TimeGenerated": "2025-11-04T23:25:01.957973Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T23:25:01.899506Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 342628,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123427,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-04T23:21:40.659687Z",
    "TimeGenerated": "2025-11-04T23:21:40.659687Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T23:21:40.602985Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 342468,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123328,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-04T23:12:52.93266Z",
    "TimeGenerated": "2025-11-04T23:12:52.93266Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T23:12:52.876151Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 342338,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123315,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-04T23:00:00.436343Z",
    "TimeGenerated": "2025-11-04T23:00:00.436343Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T23:00:00.380161Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 342107,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123214,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-04T22:43:36.063777Z",
    "TimeGenerated": "2025-11-04T22:43:36.063777Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T22:43:36.006731Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 342094,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123209,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-04T22:43:35.04997Z",
    "TimeGenerated": "2025-11-04T22:43:35.04997Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T22:43:34.99363Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 342089,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123206,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-04T22:43:34.857076Z",
    "TimeGenerated": "2025-11-04T22:43:34.857076Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T22:43:34.799682Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 341919,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123193,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-04T22:25:01.8467Z",
    "TimeGenerated": "2025-11-04T22:25:01.8467Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T22:25:01.791075Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 341874,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123187,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-04T22:21:37.957826Z",
    "TimeGenerated": "2025-11-04T22:21:37.957826Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T22:21:37.900193Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 341708,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123087,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-04T22:12:28.481514Z",
    "TimeGenerated": "2025-11-04T22:12:28.481514Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T22:12:28.327573Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 341576,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 123072,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-04T22:00:00.435352Z",
    "TimeGenerated": "2025-11-04T22:00:00.435352Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T22:00:00.378267Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 341346,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122971,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-04T21:43:33.062029Z",
    "TimeGenerated": "2025-11-04T21:43:33.062029Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T21:43:33.005578Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 341333,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122966,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-04T21:43:32.150812Z",
    "TimeGenerated": "2025-11-04T21:43:32.150812Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T21:43:32.094085Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 341328,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122963,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-04T21:43:31.9594Z",
    "TimeGenerated": "2025-11-04T21:43:31.9594Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T21:43:31.901508Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 341157,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122950,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-04T21:25:01.743126Z",
    "TimeGenerated": "2025-11-04T21:25:01.743126Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T21:25:01.686895Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 341109,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122944,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-04T21:21:35.265609Z",
    "TimeGenerated": "2025-11-04T21:21:35.265609Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T21:21:35.208682Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 340940,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122841,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-04T21:12:04.411155Z",
    "TimeGenerated": "2025-11-04T21:12:04.411155Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T21:12:04.354359Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 340813,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122827,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-04T21:00:00.43182Z",
    "TimeGenerated": "2025-11-04T21:00:00.43182Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T21:00:00.376214Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 340573,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122720,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-04T20:43:30.163034Z",
    "TimeGenerated": "2025-11-04T20:43:30.163034Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T20:43:30.10653Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 340560,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122715,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-04T20:43:29.152962Z",
    "TimeGenerated": "2025-11-04T20:43:29.152962Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T20:43:29.096199Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 340555,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122712,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-04T20:43:28.950311Z",
    "TimeGenerated": "2025-11-04T20:43:28.950311Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T20:43:28.891206Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 340382,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122699,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-04T20:25:01.641337Z",
    "TimeGenerated": "2025-11-04T20:25:01.641337Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T20:25:01.580891Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 340340,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122695,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-04T20:21:32.466038Z",
    "TimeGenerated": "2025-11-04T20:21:32.466038Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T20:21:32.409389Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 340180,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122596,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-04T20:11:39.436691Z",
    "TimeGenerated": "2025-11-04T20:11:39.436691Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T20:11:39.380564Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 339796,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122477,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-04T19:43:25.434494Z",
    "TimeGenerated": "2025-11-04T19:43:25.434494Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T19:43:25.302506Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 339791,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122474,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-04T19:43:25.153916Z",
    "TimeGenerated": "2025-11-04T19:43:25.153916Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T19:43:25.097416Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 339786,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122471,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-04T19:43:24.947437Z",
    "TimeGenerated": "2025-11-04T19:43:24.947437Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T19:43:24.889946Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 339739,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122466,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-04T19:40:09.380469Z",
    "TimeGenerated": "2025-11-04T19:40:09.380469Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T19:40:09.323933Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 339571,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122455,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-04T19:21:29.766087Z",
    "TimeGenerated": "2025-11-04T19:21:29.766087Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T19:21:29.709599Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 339436,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122359,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-04T19:15:01.500238Z",
    "TimeGenerated": "2025-11-04T19:15:01.500238Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T19:15:01.442942Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 339392,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122354,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-04T19:11:14.693844Z",
    "TimeGenerated": "2025-11-04T19:11:14.693844Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T19:11:14.637898Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 339037,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122233,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-04T18:43:23.167826Z",
    "TimeGenerated": "2025-11-04T18:43:23.167826Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T18:43:23.111435Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 339024,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122228,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-04T18:43:22.252493Z",
    "TimeGenerated": "2025-11-04T18:43:22.252493Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T18:43:22.195782Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 339019,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122225,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-04T18:43:22.054391Z",
    "TimeGenerated": "2025-11-04T18:43:22.054391Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T18:43:21.996097Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 338880,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122207,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-04T18:30:00.918573Z",
    "TimeGenerated": "2025-11-04T18:30:00.918573Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T18:30:00.862156Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 338794,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122200,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-04T18:21:27.060999Z",
    "TimeGenerated": "2025-11-04T18:21:27.060999Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T18:21:27.003614Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 338650,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122102,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-04T18:15:01.387403Z",
    "TimeGenerated": "2025-11-04T18:15:01.387403Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T18:15:01.330964Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 338599,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 122098,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-04T18:10:49.791603Z",
    "TimeGenerated": "2025-11-04T18:10:49.791603Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T18:10:49.735305Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 338265,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121986,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-04T17:43:20.163609Z",
    "TimeGenerated": "2025-11-04T17:43:20.163609Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T17:43:20.106944Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 338252,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121981,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-04T17:43:19.153529Z",
    "TimeGenerated": "2025-11-04T17:43:19.153529Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T17:43:19.096796Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 338247,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121978,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-04T17:43:18.966144Z",
    "TimeGenerated": "2025-11-04T17:43:18.966144Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T17:43:18.909237Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 338116,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121967,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-04T17:30:00.79983Z",
    "TimeGenerated": "2025-11-04T17:30:00.79983Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T17:30:00.744118Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 338027,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121961,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-04T17:21:24.264838Z",
    "TimeGenerated": "2025-11-04T17:21:24.264838Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T17:21:24.208051Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 337831,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121859,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-04T17:10:25.598765Z",
    "TimeGenerated": "2025-11-04T17:10:25.598765Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T17:10:25.542449Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 337793,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121853,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-04T17:05:01.267335Z",
    "TimeGenerated": "2025-11-04T17:05:01.267335Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T17:05:01.211787Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 337512,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121747,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-04T16:43:17.062276Z",
    "TimeGenerated": "2025-11-04T16:43:17.062276Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T16:43:17.005501Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 337499,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121742,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-04T16:43:16.053416Z",
    "TimeGenerated": "2025-11-04T16:43:16.053416Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T16:43:15.996975Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 337493,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121738,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-04T16:43:15.854817Z",
    "TimeGenerated": "2025-11-04T16:43:15.854817Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T16:43:15.798223Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 337289,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121725,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-04T16:21:21.361933Z",
    "TimeGenerated": "2025-11-04T16:21:21.361933Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T16:21:21.305265Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 337094,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121625,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-04T16:10:09.378827Z",
    "TimeGenerated": "2025-11-04T16:10:09.378827Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T16:10:09.322445Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 337086,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121622,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-04T16:10:01.245453Z",
    "TimeGenerated": "2025-11-04T16:10:01.245453Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T16:10:01.188554Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 337054,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121616,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-04T16:05:01.167648Z",
    "TimeGenerated": "2025-11-04T16:05:01.167648Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T16:05:01.111554Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 336769,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121507,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-04T15:43:15.643942Z",
    "TimeGenerated": "2025-11-04T15:43:15.643942Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T15:43:15.587291Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 336764,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121504,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-04T15:43:15.350647Z",
    "TimeGenerated": "2025-11-04T15:43:15.350647Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T15:43:15.294306Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 336745,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121498,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-04T15:43:13.567039Z",
    "TimeGenerated": "2025-11-04T15:43:13.567039Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T15:43:13.510397Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 336528,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121482,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-04T15:21:18.765335Z",
    "TimeGenerated": "2025-11-04T15:21:18.765335Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T15:21:18.707828Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 336334,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121378,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-04T15:10:05.657797Z",
    "TimeGenerated": "2025-11-04T15:10:05.657797Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T15:10:05.601578Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 336320,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121375,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-04T15:09:37.385938Z",
    "TimeGenerated": "2025-11-04T15:09:37.385938Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T15:09:37.329733Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 336293,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121369,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-04T15:05:01.052026Z",
    "TimeGenerated": "2025-11-04T15:05:01.052026Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T15:05:00.994583Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 335992,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121257,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-04T14:43:10.975712Z",
    "TimeGenerated": "2025-11-04T14:43:10.975712Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T14:43:10.919107Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 335979,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121252,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-04T14:43:10.052594Z",
    "TimeGenerated": "2025-11-04T14:43:10.052594Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T14:43:09.99609Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 335974,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 121249,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-04T14:43:09.851883Z",
    "TimeGenerated": "2025-11-04T14:43:09.851883Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T14:43:09.793546Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3\n# EASY-INSTALL-ENTRY-SCRIPT: 'cloud-init==25.1.4','console_scripts','cloud-id'\nimport re\nimport sys\n\n# for compatibility with easy_install; see #2198\n__requires__ = 'cloud-init==25.1.4'\n\ntry:\n    from importlib.metadata import distribution\nexcept ImportError:\n    try:\n        from importlib_metadata import distribution\n    except ImportError:\n        from pkg_resources import load_entry_point\n\n\ndef importlib_load_entry_point(spec, group, name):\n    dist_name, _, _ = spec.partition('==')\n    matches = (\n        entry_point\n        for entry_point in distribution(dist_name).entry_points\n        if entry_point.group == group and entry_point.name == name\n    )\n    return next(matches).load()\n\n\nglobals().setdefault('load_entry_point', importlib_load_entry_point)\n\n\nif __name__ == '__main__':\n    sys.argv[0] = re.sub(r'(-script\\.pyw?|\\.exe)?$', '', sys.argv[0])\n    sys.exit(load_entry_point('cloud-init==25.1.4', 'console_scripts', 'cloud-id')())\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 333333,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 120221,
    "SHA1": "",
    "SHA256": "c0915e3098511b7afe1d2e929818a4026c0d414a0b330ed671bc75a0d8af2c1e",
    "Timestamp": "2025-11-04T14:25:05.468418Z",
    "TimeGenerated": "2025-11-04T14:25:05.468418Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T14:25:05.41158Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n#\n#    50-motd-news - print the live news from the Ubuntu wire\n#    Copyright (C) 2016-2020 Canonical Ltd.\n#    Copyright (C) 2016-2017 Dustin Kirkland\n#\n#    Authors: Dustin Kirkland <kirkland@canonical.com>\n#             Steve Langasek <steve.langasek@canonical.com>\n#\n#    This program is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; either version 2 of the License, or\n#    (at your option) any later version.\n#\n#    This program is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n#\n#    You should have received a copy of the GNU General Public License along\n#    with this program; if not, write to the Free Software Foundation, Inc.,\n#    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.\n\n##############################################################################\n# This program could be rewritten in C or Golang for faster performance.\n# Or it could be rewritten in Python or another higher level language\n# for more modularity.\n# However, I've insisted on shell here for transparency!\n#                                                                     - Dustin\n##############################################################################\n\n# Source the local configuration\n[ -r /etc/default/motd-news ] && . /etc/default/motd-news\n\n# Exit immediately, unless we're enabled\n# This makes this script very easy to disable in /etc/default/motd-news configuration\n[ \"$ENABLED\" = \"1\" ] || exit 0\n\n# Ensure sane defaults\n[ -n \"$URLS\" ] || URLS=\"https://motd.ubuntu.com\"\n[ -n \"$WAIT\" ] || WAIT=5\n[ -n \"$CACHE\" ] || CACHE=\"/var/cache/motd-news\"\n[ \"$1\" = \"--force\" ] && FORCED=1\n\n# Ensure we print safely, maximum of the first 10 lines,\n# maximum of the first 80 chars per line, no control chars\nsafe_print() {\n\tcat \"$1\" | head -n 10 | tr -d '\\000-\\011\\013\\014\\016-\\037' | cut -c -80\n}\n\n\n# If we're not forcing an update, and we have a cached motd-news file,\n# then just print it and exit as quickly as possible, for login performance.\n# Note that systemd should keep this cache file up to date, asynchronously\nif [ \"$FORCED\" != \"1\" ]; then\n  \tif [ -r $CACHE ]; then\n\t\techo\n\t\tsafe_print $CACHE\n\telif [ \"$(id -u)\" -eq 0 ]; then\n\t\t: > $CACHE\n\tfi\n\texit 0\nfi\n\n# If we've made it here, we've been given the --force argument,\n# probably from the systemd motd-news.service.  Let's update...\n\n# Abort early if wget is missing\n[ -x /usr/bin/wget ] || exit 0\n\n# Generate our temp files, clean up when done\nNEWS=$(mktemp) || exit 1\nERR=$(mktemp) || exit 1\nCLOUD=$(mktemp) || exit 1\ntrap \"rm -f $NEWS $ERR $CLOUD\" HUP INT QUIT ILL TRAP KILL BUS TERM\n\n# Construct a user agent, similar to Firefox/Chrome/Safari/IE to\n# ensure a proper, tailored, accurate message of the day\n\n# wget browser version, for debug purposes\nwget_ver=\"$(dpkg -l wget | awk '$1 == \"ii\" { print($3); exit(0); }')\"\n\n# Distribution version, for messages releated to this Ubuntu release\n. /etc/lsb-release\nlsb=$(echo \"$DISTRIB_DESCRIPTION\" | sed -e \"s/ /\\//g\")\ncodename=\"$DISTRIB_CODENAME\"\n\n# Kernel version and CPU type, for messages related to a particular revision or hardware\nplatform=\"$(uname -o)/$(uname -r)/$(uname -m)\"\narch=\"$(uname -m)\"\ncpu=\"$(grep -m1 \"^model name\" /proc/cpuinfo | sed -e \"s/.*: //\" -e \"s:\\s\\+:/:g\")\"\ncloud_id=\"unknown\"\nif [ -x /usr/bin/cloud-id ]; then\n    /usr/bin/cloud-id > \"$CLOUD\" 2>/dev/null\n    if [ \"$?\" -eq \"0\" ]; then\n        # sanitize it a bit, just in case\n        cloud_id=$(cut -c -40 \"${CLOUD}\" | tr -c -d '[:alnum:]')\n        if [ -z \"${cloud_id}\" ]; then\n            cloud_id=\"unknown\"\n        fi\n    fi\nfi\n\n# Piece together the user agent\nUSER_AGENT=\"wget/$wget_ver $lsb $platform $cpu cloud_id/$cloud_id\"\n\n# Loop over any configured URLs\nfor u in $URLS; do\n\t# Ensu"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 333300,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 120204,
    "SHA1": "",
    "SHA256": "12d09f922c013d07b62cca4fda15a567d94133b196c23193784f1725562ad754",
    "Timestamp": "2025-11-04T14:25:05.418109Z",
    "TimeGenerated": "2025-11-04T14:25:05.418109Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T14:25:05.361379Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 333254,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 120199,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-04T14:21:15.94966Z",
    "TimeGenerated": "2025-11-04T14:21:15.94966Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T14:21:15.893294Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# This script is called by \"systemctl enable/disable\" when the given unit is a\n# SysV init.d script. It needs to call the distribution's mechanism for\n# enabling/disabling those, such as chkconfig, update-rc.d, or similar. This\n# can optionally take a --root argument for enabling a SysV init script\n# in a chroot or similar.\nset -eu\n\nusage() {\n    echo \"Usage: $0 [--root=path] enable|disable|is-enabled <sysv script name>\" >&2\n    exit 1\n}\n\nROOT=\n\n# parse options\neval set -- \"$(getopt -o r: --long root: -- \"$@\")\"\nwhile true; do\n    case \"$1\" in\n        -r|--root)\n            ROOT=\"$2\"\n            shift 2 ;;\n        --) shift ; break ;;\n        *) usage ;;\n    esac\ndone\n\nNAME=\"${2:-}\"\n\nrun() {\n    if [ -n \"$ROOT\" ] && [ \"$ROOT\" != \"/\" ]; then\n        _SKIP_SYSTEMD_NATIVE=1 chroot \"$ROOT\" /usr/sbin/update-rc.d \"$@\"\n    else\n        _SKIP_SYSTEMD_NATIVE=1 /usr/sbin/update-rc.d \"$@\"\n    fi\n}\n\n[ -n \"$NAME\" ] || usage\n\ncase \"$1\" in\n    enable)\n        # call the command to enable SysV init script $NAME here..\n        run \"$NAME\" defaults\n        run \"$NAME\" enable\n        ;;\n    disable)\n        run \"$NAME\" defaults\n        run \"$NAME\" disable\n        ;;\n    is-enabled)\n        # exit with 0 if $NAME is enabled, non-zero if it is disabled\n        ls \"$ROOT\"/etc/rc[S5].d/S??\"$NAME\" >/dev/null 2>&1\n        ;;\n    *)\n        usage ;;\nesac\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 332915,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 120133,
    "SHA1": "",
    "SHA256": "dba758ee9a9c9a5c76047b275ce6215c8f669cc7689548e9ac8ff32a9513eff4",
    "Timestamp": "2025-11-04T14:20:14.33351Z",
    "TimeGenerated": "2025-11-04T14:20:14.33351Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T14:20:14.244407Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n#set -e\n#\n# This file understands the following apt configuration variables:\n# Values here are the default.\n# Create /etc/apt/apt.conf.d/10periodic file to set your preference.\n#\n# All of the n-days interval options also accept the suffixes\n# s for seconds, m for minutes, h for hours, d for days or\n# the \"always\" value to do the action for every job run,\n# which can be used with systemd OnCalendar overrides to\n# define custom schedules for the apt update/upgrade jobs.\n#\n#  Dir \"/\";\n#  - RootDir for all configuration files\n#\n#  Dir::Cache \"var/cache/apt/\";\n#  - Set apt package cache directory\n#\n#  Dir::Cache::Archives \"archives/\";\n#  - Set package archive directory\n#\n#  APT::Periodic::Enable \"1\";\n#  - Enable the update/upgrade script (0=disable)\n#\n#  APT::Periodic::BackupArchiveInterval \"0\";\n#  - Backup after n-days if archive contents changed.(0=disable)\n#\n#  APT::Periodic::BackupLevel \"3\";\n#  - Backup level.(0=disable), 1 is invalid.\n#\n#  Dir::Cache::Backup \"backup/\";\n#  - Set periodic package backup directory\n#\n#  APT::Archives::MaxAge \"0\"; (old, deprecated)\n#  APT::Periodic::MaxAge \"0\"; (new)\n#  - Set maximum allowed age of a cache package file. If a cache \n#    package file is older it is deleted (0=disable)\n#\n#  APT::Archives::MinAge \"2\"; (old, deprecated)\n#  APT::Periodic::MinAge \"2\"; (new)\n#  - Set minimum age of a package file. If a file is younger it\n#    will not be deleted (0=disable). Useful to prevent races\n#    and to keep backups of the packages for emergency.\n#\n#  APT::Archives::MaxSize \"0\"; (old, deprecated)\n#  APT::Periodic::MaxSize \"0\"; (new)\n#  - Set maximum size of the cache in MB (0=disable). If the cache\n#    is bigger, cached package files are deleted until the size\n#    requirement is met (the oldest packages will be deleted \n#    first).\n#\n#  APT::Periodic::Update-Package-Lists \"0\";\n#  - Do \"apt-get update\" automatically every n-days (0=disable)\n#    \n#  APT::Periodic::Download-Upgradeable-Packages \"0\";\n#  - Do \"apt-get upgrade --download-only\" every n-days (0=disable)\n#\n#  APT::Periodic::Download-Upgradeable-Packages-Debdelta \"1\";\n#  - Use debdelta-upgrade to download updates if available (0=disable)\n#\n#  APT::Periodic::Unattended-Upgrade \"0\";\n#  - Run the \"unattended-upgrade\" security upgrade script \n#    every n-days (0=disabled)\n#    Requires the package \"unattended-upgrades\" and will write\n#    a log in /var/log/unattended-upgrades\n# \n#  APT::Periodic::AutocleanInterval \"0\";\n#  - Do \"apt-get autoclean\" every n-days (0=disable)\n#\n#  APT::Periodic::CleanInterval \"0\";\n#  - Do \"apt-get clean\" every n-days (0=disable)\n#\n#  APT::Periodic::Verbose \"0\";\n#  - Send report mail to root\n#      0:  no report             (or null string)\n#      1:  progress report       (actually any string)\n#      2:  + command outputs     (remove -qq, remove 2>/dev/null, add -d)\n#      3:  + trace on            \n#\n\ncheck_stamp()\n{\n    stamp=\"$1\"\n    interval=\"$2\"\n\n    if [ \"$interval\" = always ]; then\n\tdebug_echo \"check_stamp: ignoring time stamp file, interval set to always\"\n\t# treat as enough time has passed\n        return 0\n    fi\n\n    if [ \"$interval\" = 0 ]; then\n\tdebug_echo \"check_stamp: interval=0\"\n\t# treat as no time has passed\n        return 1\n    fi\n\n    if [ ! -f \"$stamp\" ]; then\n\tdebug_echo \"check_stamp: missing time stamp file: $stamp.\"\n\t# treat as enough time has passed\n        return 0\n    fi\n\n    # compare midnight today to midnight the day the stamp was updated\n    stamp_file=\"$stamp\"\n    stamp=$(date --date=\"$(date -r \"$stamp_file\" --iso-8601)\" +%s 2>/dev/null)\n    if [ \"$?\" != \"0\" ]; then\n        # Due to some timezones returning 'invalid date' for midnight on\n        # certain dates (e.g. America/Sao_Paulo), if date returns with error\n        # remove the stamp file and return 0. See coreutils bug:\n        # http://lists.gnu.org/archive/html/bug-coreutils/2007-09/msg00176.html\n        rm -f \"$stamp_file\"\n        return 0\n    fi\n\n    now=$(date --date=\"$(date --iso-8601)\" +%s 2>/dev/null)\n    if ["
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 332605,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119953,
    "SHA1": "",
    "SHA256": "4949c220a844071ee4709115aadfc00684578d5c7dda9c1b5a5c65a75de9d50f",
    "Timestamp": "2025-11-04T14:16:20.470023Z",
    "TimeGenerated": "2025-11-04T14:16:20.470023Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T14:16:20.413739Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 332512,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119936,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-04T14:09:13.403775Z",
    "TimeGenerated": "2025-11-04T14:09:13.403775Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T14:09:13.347748Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 332429,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119926,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-04T14:00:00.889082Z",
    "TimeGenerated": "2025-11-04T14:00:00.889082Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T14:00:00.829801Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 332387,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119921,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-04T13:55:01.940858Z",
    "TimeGenerated": "2025-11-04T13:55:01.940858Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T13:55:01.883396Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 332163,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119811,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-04T13:43:06.238643Z",
    "TimeGenerated": "2025-11-04T13:43:06.238643Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T13:43:06.18046Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 332158,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119808,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-04T13:43:06.033881Z",
    "TimeGenerated": "2025-11-04T13:43:06.033881Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T13:43:05.902482Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 332153,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119805,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-04T13:43:05.760965Z",
    "TimeGenerated": "2025-11-04T13:43:05.760965Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T13:43:05.704194Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 331938,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119786,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-04T13:21:13.061101Z",
    "TimeGenerated": "2025-11-04T13:21:13.061101Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T13:21:13.004807Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 331722,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119678,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-04T13:08:48.55263Z",
    "TimeGenerated": "2025-11-04T13:08:48.55263Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T13:08:48.496584Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 331643,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119669,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-04T13:00:00.35629Z",
    "TimeGenerated": "2025-11-04T13:00:00.35629Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T13:00:00.298897Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 331600,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119662,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-04T12:55:01.842639Z",
    "TimeGenerated": "2025-11-04T12:55:01.842639Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T12:55:01.784911Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 331394,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119557,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-04T12:43:04.058935Z",
    "TimeGenerated": "2025-11-04T12:43:04.058935Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T12:43:04.002492Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 331381,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119552,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-04T12:43:03.151449Z",
    "TimeGenerated": "2025-11-04T12:43:03.151449Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T12:43:03.094905Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 331375,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119548,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-04T12:43:02.967718Z",
    "TimeGenerated": "2025-11-04T12:43:02.967718Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T12:43:02.910979Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 331153,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119526,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-04T12:21:09.364024Z",
    "TimeGenerated": "2025-11-04T12:21:09.364024Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T12:21:09.307393Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 330942,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119421,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-04T12:08:24.231668Z",
    "TimeGenerated": "2025-11-04T12:08:24.231668Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T12:08:24.17507Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 330825,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119410,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-04T11:55:01.735717Z",
    "TimeGenerated": "2025-11-04T11:55:01.735717Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T11:55:01.67897Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 330759,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119400,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-04T11:50:04.555222Z",
    "TimeGenerated": "2025-11-04T11:50:04.555222Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T11:50:04.497314Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 330615,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119301,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-04T11:43:01.267105Z",
    "TimeGenerated": "2025-11-04T11:43:01.267105Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T11:43:01.210436Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 330601,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119296,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-04T11:43:00.349987Z",
    "TimeGenerated": "2025-11-04T11:43:00.349987Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T11:43:00.293256Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 330595,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119292,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-04T11:43:00.145265Z",
    "TimeGenerated": "2025-11-04T11:43:00.145265Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T11:43:00.088216Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 330367,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119267,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-04T11:21:06.56771Z",
    "TimeGenerated": "2025-11-04T11:21:06.56771Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T11:21:06.507933Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 330156,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119161,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-04T11:07:57.586642Z",
    "TimeGenerated": "2025-11-04T11:07:57.586642Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T11:07:57.530492Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 330032,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119147,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-04T10:55:01.637637Z",
    "TimeGenerated": "2025-11-04T10:55:01.637637Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T10:55:01.580827Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 329970,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119137,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-04T10:50:04.224404Z",
    "TimeGenerated": "2025-11-04T10:50:04.224404Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T10:50:04.166379Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 329823,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119037,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-04T10:42:58.268649Z",
    "TimeGenerated": "2025-11-04T10:42:58.268649Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T10:42:58.211995Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 329808,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119031,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-04T10:42:57.25573Z",
    "TimeGenerated": "2025-11-04T10:42:57.25573Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T10:42:57.199307Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 329802,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 119027,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-04T10:42:57.066427Z",
    "TimeGenerated": "2025-11-04T10:42:57.066427Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T10:42:57.009205Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 329568,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118993,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-04T10:21:03.761296Z",
    "TimeGenerated": "2025-11-04T10:21:03.761296Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T10:21:03.704117Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 329345,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118884,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-04T10:07:33.395353Z",
    "TimeGenerated": "2025-11-04T10:07:33.395353Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T10:07:33.338503Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 329221,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118868,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-04T09:55:01.536337Z",
    "TimeGenerated": "2025-11-04T09:55:01.536337Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T09:55:01.479916Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 329012,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118763,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-04T09:42:55.265484Z",
    "TimeGenerated": "2025-11-04T09:42:55.265484Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T09:42:55.208754Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 328997,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118757,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-04T09:42:54.252255Z",
    "TimeGenerated": "2025-11-04T09:42:54.252255Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T09:42:54.195971Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 328990,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118752,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-04T09:42:54.06188Z",
    "TimeGenerated": "2025-11-04T09:42:54.06188Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T09:42:54.005096Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 328867,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118742,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-04T09:30:01.055158Z",
    "TimeGenerated": "2025-11-04T09:30:01.055158Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T09:30:00.999616Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 328760,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118725,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-04T09:21:01.060727Z",
    "TimeGenerated": "2025-11-04T09:21:01.060727Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T09:21:01.003999Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 328542,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118616,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-04T09:07:09.15441Z",
    "TimeGenerated": "2025-11-04T09:07:09.15441Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T09:07:09.097988Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 328428,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118605,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-04T08:55:01.428817Z",
    "TimeGenerated": "2025-11-04T08:55:01.428817Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T08:55:01.373164Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 328220,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118499,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-04T08:42:52.269244Z",
    "TimeGenerated": "2025-11-04T08:42:52.269244Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T08:42:52.212991Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 328205,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118493,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-04T08:42:51.251117Z",
    "TimeGenerated": "2025-11-04T08:42:51.251117Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T08:42:51.194547Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 328199,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118489,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-04T08:42:51.070159Z",
    "TimeGenerated": "2025-11-04T08:42:51.070159Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T08:42:51.013131Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 328069,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118476,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-04T08:30:00.437709Z",
    "TimeGenerated": "2025-11-04T08:30:00.437709Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T08:30:00.381685Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 327970,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118459,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-04T08:20:58.568265Z",
    "TimeGenerated": "2025-11-04T08:20:58.568265Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T08:20:58.510097Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/usr/bin/python3 -Es\n\n# lsb_release command for Debian\n# (C) 2005-10 Chris Lawrence <lawrencc@debian.org>\n\n#    This package is free software; you can redistribute it and/or modify\n#    it under the terms of the GNU General Public License as published by\n#    the Free Software Foundation; version 2 dated June, 1991.\n\n#    This package is distributed in the hope that it will be useful,\n#    but WITHOUT ANY WARRANTY; without even the implied warranty of\n#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#    GNU General Public License for more details.\n\n#    You should have received a copy of the GNU General Public License\n#    along with this package; if not, write to the Free Software\n#    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n#    02110-1301 USA\n\nfrom optparse import OptionParser\nimport sys\nimport os\nimport re\n\nimport lsb_release\n\ndef main():\n    parser = OptionParser()\n    parser.add_option('-v', '--version', dest='version', action='store_true',\n                      default=False,\n                      help=\"show LSB modules this system supports\")\n    parser.add_option('-i', '--id', dest='id', action='store_true',\n                      default=False,\n                      help=\"show distributor ID\")\n    parser.add_option('-d', '--description', dest='description',\n                      default=False, action='store_true',\n                      help=\"show description of this distribution\")\n    parser.add_option('-r', '--release', dest='release',\n                      default=False, action='store_true',\n                      help=\"show release number of this distribution\")\n    parser.add_option('-c', '--codename', dest='codename',\n                      default=False, action='store_true',\n                      help=\"show code name of this distribution\")\n    parser.add_option('-a', '--all', dest='all',\n                      default=False, action='store_true',\n                      help=\"show all of the above information\")\n    parser.add_option('-s', '--short', dest='short',\n                      action='store_true', default=False,\n                      help=\"show requested information in short format\")\n    \n    (options, args) = parser.parse_args()\n    if args:\n        parser.error(\"No arguments are permitted\")\n\n    short = (options.short)\n    none = not (options.all or options.version or options.id or\n                options.description or options.codename or options.release)\n\n    distinfo = lsb_release.get_distro_information()\n\n    if none or options.all or options.version:\n        verinfo = lsb_release.check_modules_installed()\n        if not verinfo:\n            print(\"No LSB modules are available.\", file=sys.stderr)\n        elif short:\n            print(':'.join(verinfo))\n        else:\n            print('LSB Version:\\t' + ':'.join(verinfo))\n\n    if options.id or options.all:\n        if short:\n            print(distinfo.get('ID', 'n/a'))\n        else:\n            print('Distributor ID:\\t%s' % distinfo.get('ID', 'n/a'))\n\n    if options.description or options.all:\n        if short:\n            print(distinfo.get('DESCRIPTION', 'n/a'))\n        else:\n            print('Description:\\t%s' % distinfo.get('DESCRIPTION', 'n/a'))\n\n    if options.release or options.all:\n        if short:\n            print(distinfo.get('RELEASE', 'n/a'))\n        else:\n            print('Release:\\t%s' % distinfo.get('RELEASE', 'n/a'))\n\n    if options.codename or options.all:\n        if short:\n            print(distinfo.get('CODENAME', 'n/a'))\n        else:\n            print('Codename:\\t%s' % distinfo.get('CODENAME', 'n/a'))\n\nif __name__ == '__main__':\n    main()\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 327747,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118351,
    "SHA1": "",
    "SHA256": "484b6a9de8b41aa9310a305b64c092e473ee73bead994e52c4271c66df9ba3c8",
    "Timestamp": "2025-11-04T08:06:44.59896Z",
    "TimeGenerated": "2025-11-04T08:06:44.59896Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T08:06:44.448231Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# vim:ts=2:et\n# Debian sa1 helper which is run from cron.d job, not to needlessly\n# fill logs (see Bug#499461).\n\nset -e\n\n# Skip in favour of systemd timer\n[ ! -d /run/systemd/system ] || exit 0\n\n# Our configuration file\nDEFAULT=/etc/default/sysstat\n# Default setting, overridden in the above file\nENABLED=false\n\n# Read defaults file\n[ ! -r \"$DEFAULT\" ] || . \"$DEFAULT\"\n\n[ \"$ENABLED\" = \"true\" ] || exit 0\n\nexec /usr/lib/sysstat/sa1 \"$@\"\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 327643,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118340,
    "SHA1": "",
    "SHA256": "dbcc108e4c4b56ce676a2e512ffd0dc06fd211dfb606d9fd25764f71ea62f9b0",
    "Timestamp": "2025-11-04T07:55:01.305584Z",
    "TimeGenerated": "2025-11-04T07:55:01.305584Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T07:55:01.249763Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python3 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo python2 open_files.py --ScriptName open_files.py --id log4j_handlersV2 --filter-env LOG4J_FORMAT_MSG_NO_LOOKUPS=true --filter-name \"log4j,LOG4J,spring-core\" --filter-command \"java,javaw\" --manifest-path \"META-INF/maven/org.apache.logging.log4j/log4j-core/pom.properties\" --marker-path /var/opt/microsoft/mdatp/wdavedr/log4jMitigationApplied --collect-dirlist /log4j/core/lookup/JndiLookup.class,log4j-,spring-core-\n# sudo rm /opt/microsoft/mdatp/resources/cache/log4j_handlersV2.json \n\nfrom genericpath import isdir\nimport os\nimport re\nimport sys\nimport json\nfrom datetime import datetime as dt\nimport zipfile\nimport string\nimport argparse\nimport traceback\nimport functools\nimport itertools\nimport subprocess as sb\n\npy_version = sys.version_info\nif py_version.major == 3:\n    if py_version.minor >= 11:\n        from datetime import UTC\n    else:\n        from datetime import timezone as UTC\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_OLD_PATH = \"META-INF/MANIFEST.MF\"\n\ndef take(n, l):\n    for i, item in enumerate(l):\n        if i > n:\n            break\n        yield item\n\nclass Jar:\n    def __init__(self, path):\n        self.path = path\n        self._manifest = {}\n        self._dirlist = []\n\n    def _parse_manifest(self, lines):\n        version_indication = \"version=\"\n        version_lines = [line for line in lines if line.startswith(version_indication)]\n\n        if len(version_lines) > 0:\n            version = version_lines[0][len(version_indication):]\n            yield 'Version', version.strip()\n\n        field_names = ['Specification-Version', 'Specification-Title', 'Specification-Vendor', 'Implementation-Version', 'Implementation-Title', 'Implementation-Vendor']\n        for line in lines:\n            if any(line.startswith(field_name) for field_name in field_names):\n                    key, value = line.split(':')\n                    yield key.strip(), value.strip()\n\n    def _open(self):\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        return zipfile.ZipFile(self.path)\n\n    def _read_dirlist(self):\n        with self._open() as zf:\n            filenames = dict(p for p in zf.namelist())\n            return [f for f in filenames if any(r.search(f.lower()) for r in args.dirlist)]\n\n\n\n    def _get_manifest_path(self, zf):\n        for path in [args.manifest_path, MANIFEST_OLD_PATH]:\n            if path in zf.namelist():\n                return path\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    # Not found manifest file\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if (manifest_info.file_size > MAX_FILE_SIZE):\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return dict((k, v) for k, v in manifest\n                            if not args.manifest_keys or any(m.search(k.lower()) for m in args.manifest_keys))\n        except:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n        "
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 327383,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118214,
    "SHA1": "",
    "SHA256": "b5f540498712f4d577fa2c8841efc0d6e5e22a3797fb8bb70c6e2cfddd36cab2",
    "Timestamp": "2025-11-04T07:42:46.437742Z",
    "TimeGenerated": "2025-11-04T07:42:46.437742Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T07:42:46.380396Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# -*- coding: utf-8 -*-\r\n# sudo python2 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\n# sudo python3 find_python_package.py --ScriptName find_python_package.py --package <package_name> -d /home/user/envs,/opt/venvs -g /usr/local/lib,/tmp/venv/lib\r\nfrom __future__ import print_function, division\r\nimport os\r\nimport argparse\r\nimport json\r\nimport time\r\nimport traceback\r\nimport functools\r\nimport sys\r\nimport re\r\nimport io\r\n\r\nRELEASE_MODE = True\r\nSKIP_RESULTS = False\r\n\r\ndef outputdebug(message):\r\n    if not RELEASE_MODE:\r\n        print(message)\r\n\r\ndef parse_version(version_str):\r\n    parts = version_str.split(\".\")\r\n    major = int(parts[0])\r\n    minor = int(parts[1]) if len(parts) > 1 else 0\r\n    return major, minor\r\n\r\n# reading the file to get the version for reliability instead of getting from the path\r\ndef read_from_metadata(path):\r\n    outputdebug(\"Reading metadata from: {}\".format(path))\r\n\r\n    results = {}\r\n\r\n    with io.open(path, \"r\", encoding=\"utf-8\") as f:\r\n        for line in f:\r\n            if line.startswith(\"Version:\"):\r\n                results[\"version\"] = line.split(\":\", 1)[1].strip()\r\n            if line.startswith(\"Name:\"):\r\n                results[\"packageName\"] = line.split(\":\", 1)[1].strip()\r\n\r\n    return results\r\n\r\n\r\ndef find_pyvenv_cfg_paths(search_dirs):\r\n    pyvenv_paths = []\r\n    for base_dir in search_dirs:\r\n        for root, dirs, files in os.walk(base_dir):\r\n            if \"pyvenv.cfg\" in files:\r\n                pyvenv_paths.append(os.path.join(root, \"pyvenv.cfg\"))\r\n    return pyvenv_paths\r\n\r\ndef find_package_metadata(env_root, packages, is_venv=False):\r\n    matches = []\r\n\r\n    def scan_site_packages(site_pkgs):\r\n        if not os.path.isdir(site_pkgs):\r\n            return\r\n        outputdebug(\"Scanning: {}\".format(site_pkgs))\r\n        for d in os.listdir(site_pkgs):\r\n            metadata_path = os.path.join(site_pkgs, d, \"METADATA\")\r\n            for package in packages:\r\n                if (\r\n                    d.lower().startswith(package.lower() + \"-\")\r\n                    and d.endswith(\".dist-info\")\r\n                    and os.path.isfile(metadata_path)\r\n                ):\r\n                    matches.append(metadata_path)\r\n\r\n    if is_venv:\r\n        for lib_dir in [\"lib\", \"lib64\", \"Lib\"]:\r\n            lib_path = os.path.join(env_root, lib_dir)\r\n            if not os.path.isdir(lib_path):\r\n                continue\r\n            for pyver in os.listdir(lib_path):\r\n                site_pkgs = os.path.join(lib_path, pyver, \"site-packages\")\r\n                scan_site_packages(site_pkgs)\r\n    else:\r\n        scan_site_packages(env_root)\r\n\r\n    return matches\r\n\r\ndef get_installed_python_versions(min_version):\r\n    base_dirs = [\"/usr/lib\", \"/usr/local/lib\", \"/usr/lib64\", \"/usr/local/lib64\", \"/tmp/venv/lib\"]\r\n    found_versions = set()\r\n    version_pattern = re.compile(r'python(\\d+)\\.(\\d+)')\r\n\r\n    min_py_tuple = parse_version(min_version)\r\n    outputdebug(\"min python version: {}\".format(min_version))\r\n\r\n    for base in base_dirs:\r\n        try:\r\n            for entry in os.listdir(base):\r\n                match = version_pattern.match(entry)\r\n                if match:\r\n                    ver_major = int(match.group(1))\r\n                    ver_minor = int(match.group(2))\r\n                    if (ver_major, ver_minor) >= min_py_tuple:\r\n                        found_versions.add(\"python{}.{}\".format(ver_major, ver_minor))\r\n        except OSError:\r\n            continue\r\n\r\n    return sorted(found_versions)\r\n\r\ndef run_scan(search_dirs, global_dirs, packages, min_python_version):\r\n    outputdebug(\"\\nRunning scan\")\r\n    results = []\r\n\r\n    # Scan for pyvenv.cfg to locate virtual environments\r\n    # Avoids false positives from unrelated site-packages paths\r\n    # Improves accuracy and keeps logic maintainable\r\n    pyvenv_cfgs = find_pyvenv_cfg_paths(search_dirs)\r\n    for cfg_path in pyvenv_cfgs:\r\n        venv_root = o"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 327377,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118211,
    "SHA1": "",
    "SHA256": "df572c651ad49067e0dcce72f3bd6c9e023eaf8c639a9317f7ef4bedf46b328a",
    "Timestamp": "2025-11-04T07:42:46.23389Z",
    "TimeGenerated": "2025-11-04T07:42:46.23389Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T07:42:46.100812Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "# sudo python2 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n# sudo python3 get_jar_data_list.py --ScriptName get_jar_data_list.py --jar-search-path \"/usr/sap/*/*/j2ee/cluster/apps/sap.com/devserver_metadataupload_ear/servlet_jsp/developmentserver/root/WEB-INF/lib/devserver_metadataupload_war.jar\" --collect-manifest-keys \"implementation-version\",\"implementation-vendor\"\n\nimport os\nimport re\nimport sys\nimport json\nimport zipfile\nimport argparse\nimport traceback\nimport functools\nimport glob\n\nMAX_FILE_SIZE = 1024 * 1024  # 1MB\nMANIFEST_DEFAULT_PATH = \"META-INF/MANIFEST.MF\"\n\nclass Jar:\n    def __init__(self, path, manifest_path=None, manifest_keys=None):\n        self.path = path\n        self.manifest_path = manifest_path\n        self.manifest_keys = manifest_keys or []\n        self._manifest = {}\n\n    def _parse_manifest(self, lines):\n        for line in lines:\n            if not line.strip() or ':' not in line:\n                continue\n            try:\n                key, value = line.split(':', 1)\n                key, value = key.strip(), value.strip()\n                if any(manifest_key.match(key.lower()) for manifest_key in self.manifest_keys):\n                    yield key, value\n            except ValueError:\n                raise ValueError(\"Invalid manifest line: {}\".format(line))\n\n    def _open(self):\n        if not os.path.exists(self.path):\n            raise ValueError(\"path does not exist: {}\".format(self.path))\n        if not zipfile.is_zipfile(self.path):\n            raise ValueError(\"path is not a zip file: {}\".format(self.path))\n        if sys.version_info >= (3, 8):\n            return zipfile.ZipFile(self.path, strict_timestamps=True)\n        else:\n            return zipfile.ZipFile(self.path)\n\n    def _get_manifest_path(self, zf):\n        if self.manifest_path and self.manifest_path in zf.namelist():\n            return self.manifest_path\n        return None\n\n    def _read_manifest(self, throw_on_error=False):\n        try:\n            with self._open() as zf:\n                manifest_path = self._get_manifest_path(zf)\n                if not manifest_path:\n                    return {}\n\n                manifest_info = zf.getinfo(manifest_path)\n                if manifest_info.file_size > MAX_FILE_SIZE:\n                    raise IOError(\"manifest file is too big\")\n\n                with zf.open(manifest_path) as f:\n                    readline_f = functools.partial(f.readline, MAX_FILE_SIZE)\n                    manifest_lines = list(x.decode().strip() for x in iter(readline_f, b''))\n                    manifest = self._parse_manifest(manifest_lines)\n                    return {k: v for k, v in manifest}\n        except Exception:\n            sys.stderr.write(\"error while reading manifest of '{}': {}\\n\".format(self.path, traceback.format_exc()))\n\n            if throw_on_error:\n                raise\n\n            return {}\n\n    def manifest(self, throw_on_error=False):\n        if not self._manifest:\n            self._manifest = self._read_manifest(throw_on_error)\n        return self._manifest\n\n\nclass FatalArgumentError(Exception):\n    pass\n\n\ndef split_by_comma(dest):\n    return [x.strip() for x in dest.split(\",\")]\n\n\ndef split_and_compile(dest):\n    return [re.compile(r) for r in split_by_comma(dest)]\n\n\ndef validate_limit(dest):\n    limit = int(dest)\n    if limit < 1:\n        raise ValueError(\"limit is too small\")\n    return limit\n\ndef validate_manifest_path(dest):\n    normalized_path = os.path.normpath(dest)\n    if normalized_path.startswith(\"..\") or normalized_path.startswith(\"/\"):\n        raise ValueError(\"invalid manifest path: {}\".format(dest))\n    return normalized_path\n\ndef parse_args():\n    parser = argparse.ArgumentParser()\n    parser.add_argument(\"--ScriptName\", dest"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 327371,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118207,
    "SHA1": "",
    "SHA256": "e9f5659d01b208f4e4395e678221a0aaea6b271eec2baaea967a91fcfe9680e0",
    "Timestamp": "2025-11-04T07:42:45.959107Z",
    "TimeGenerated": "2025-11-04T07:42:45.959107Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T07:42:45.901164Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/sh\n# /usr/lib/sysstat/sa1\n# (C) 1999-2020 Sebastien Godard (sysstat <at> orange.fr)\n#\n#@(#) sysstat-12.5.2\n#@(#) sa1: Collect and store binary data in system activity data file.\n#\n\n# Set default value for some variables.\n# Used only if ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} doesn't exist!\nHISTORY=0\nSADC_OPTIONS=\"\"\nSA_DIR=/var/log/sysstat\nSYSCONFIG_DIR=/etc/sysstat\nSYSCONFIG_FILE=sysstat\nUMASK=0022\nLONG_NAME=n\n\n[ -r ${SYSCONFIG_DIR}/${SYSCONFIG_FILE} ] && . ${SYSCONFIG_DIR}/${SYSCONFIG_FILE}\n\numask ${UMASK}\n\n# If the user-supplied value for SA_DIR in sysconfig file is not a directory\n# then fall back on default directory. Create this default directory if it doesn't exist.\n[ -d ${SA_DIR} ] || SA_DIR=/var/log/sysstat\n[ -d /var/log/sysstat ] || mkdir /var/log/sysstat\n\nif [ ${HISTORY} -gt 28 ]\nthen\n\tSADC_OPTIONS=\"${SADC_OPTIONS} -D\"\n\tLONG_NAME=y\nfi\n\nENDIR=/usr/lib/sysstat\ncd ${ENDIR}\n[ \"$1\" = \"--boot\" ] && shift && BOOT=y || BOOT=n\n[ \"$1\" = \"--sleep\" ] && shift && SLEEP=y || SLEEP=n\n\nROTATE=n\n[ \"$1\" = \"--rotate\" ] && shift && ROTATE=y && [ \"$1\" = \"iso\" ] && shift && LONG_NAME=y\nif [ \"${ROTATE}\" = \"y\" ]\nthen\n\tif [ \"${LONG_NAME}\" = \"y\" ]\n\tthen\n\t\tDATE=`date --date=yesterday +%Y%m%d`\n\telse\n\t\tDATE=`date --date=yesterday +%d`\n\tfi\n\tSA_DIR=${SA_DIR}/sa${DATE}\nfi\n\nif [ \"${SLEEP}\" = \"y\" ]\nthen\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} -C \"LINUX SLEEP MODE ($*)\" ${SA_DIR}\nelif [ $# = 0 ] && [ \"${BOOT}\" = \"n\" ]\nthen\n# Note: Stats are written at the end of previous file *and* at the\n# beginning of the new one (when there is a file rotation) only if\n# outfile has not been explicitly specified on the command line...\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} 1 1 ${SA_DIR}\nelse\n\texec ${ENDIR}/sadc -F -L ${SADC_OPTIONS} $* ${SA_DIR}\nfi\n"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 327237,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118190,
    "SHA1": "",
    "SHA256": "c3dc69bd9576e336b57e0462f414b8da007011b9e03fb3c86e9097dede956b1d",
    "Timestamp": "2025-11-04T07:30:00.433847Z",
    "TimeGenerated": "2025-11-04T07:30:00.433847Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T07:30:00.375573Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  },
  {
    "TenantId": "674f96b1-63d6-48ca-9fe6-d613e4292c7f",
    "AccountDomain": "",
    "AccountName": "",
    "AccountSid": "",
    "ActionType": "ScriptContent",
    "AdditionalFields": {
      "ScriptContent": "#!/bin/bash\n\n#\n# WARNING: If you happen to edit this file then get the SHA256 using 'sha256sum setup_iptable_rules.sh' command\n# and modify the isolateDeviceCommandHandler.cpp and UnioslateDeviceCommandHandler.cpp with the new SHA\n#\n\nMDE_IPTABLE_BASE_CMD=\"iptables \"     \nMDE_IP6TABLE_BASE_CMD=\"ip6tables \"   \nMDE_CHAIN=mdechain\nMDE_PACKET_STAMP=\"-m mark ! --mark 0x1/0x1\"\nMDE_NFQUEUE_BYPASS=\"******* --queue-num 0 --queue-bypass\"\nMDE_TCP_PACKET_FILTER=\"-p tcp --tcp-flags FIN,SYN,RST,ACK,PSH SYN\"\nMDE_TCP_PACKET_FILTER_SAVE=\"-m tcp --tcp-flags FIN,SYN,RST,PSH,ACK SYN\"\nMDE_UDP_PACKET_FILTER=\"-p udp\"\nMDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp-port-unreachable\"\nMDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE=\"--reject-with icmp6-port-unreachable\"\nMDE_SUSE_FW=\"SuSEfirewall2\"\nMDE_RETRY_COUNT=3\nMDE_RETRY_DELAY=10s\nMDE_ALREADY_EXIST_CODE=17\nISOLATE_SETTINGS_KEY='\"isDeviceIsolated\"'\n\nWDAV_SETTINGS_PATH='/var/opt/microsoft/mdatp/wdavstate'\nprocess_name=\"mdatp\"\n\nif [ \"$(id -u)\" != \"0\" ] ; then\n   logger -p ********** -t \"setup_iptables_rules\" \"User has insufficient privilege\"\n   echo \"setup_iptables_rules\" \"User has insufficient privilege\"\n   exit 4\nfi\n\nfunction retry(){\n    local n=1\n    cmd=\"$@\"\n    while true; do\n        echo \"retry command \\\"$@\\\" attempt $n/$MDE_RETRY_COUNT.\"\n        output=$($cmd 2>&1) || exitcode=\"$?\"\n        if [[ $exitcode -eq 0 ]]; then\n            echo \"command '\"$@\"' succeeded attempt $n/$MDE_RETRY_COUNT.\"\n            return 0\n        fi\n        # iptables commands exit codes are \n        #   0 - correct functioning\n        #   1 - any error that is not related to command line parameters\n        #   2 - invalid or abused command line parameters\n        #   4 - retry command failed, actual exit code will reported as part of script output.\n        # in case command failed due to already existing chain\\rule should hanlde it differently.\n        if [[ $exitcode -eq 1 ]] && [[ $output == *\"already exists\"* ]]; then \n            echo \"retry command already exists code attempt $n/$MDE_RETRY_COUNT.\"\n            return $MDE_ALREADY_EXIST_CODE\n        fi\n        echo \"retry command failed attempt $n/$MDE_RETRY_COUNT: output: $output, exitcode: $exitcode\"\n        if [[ $n -le $MDE_RETRY_COUNT ]]; then\n            ((n++))\n            sleep $MDE_RETRY_DELAY\n        else\n            exit 4\n        fi\n    done\n}\n\nrun_or_fail() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      echo \"setup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      exit 4\n   fi\n}\n\nrun_or_warn() {\n   cmd=\"$@\"\n   status=\"0\"\n   out=$($cmd 2>&1) || status=\"$?\"\n   \n   if [ \"$status\" != \"0\" ]; then\n      cmd=$(echo $cmd | /bin/sed 's/[[:space:]]/ /g')\n      logger -p ********** -t \"cleanup_iptables_rules\" \"\\\"$cmd\\\" returns with code: $status, message: \\\"$out\\\"\"\n      echo \"cleanup_iptables_rules\" \"Failed to run: \\\"$cmd\\\", error code: $status, \\\"$out\\\"\"\n      return 4\n   fi\n}\n\nretrieve_expected_rules() {\n   trap 'catch_failed_isolation_status $LINENO' ERR\n\n   local whether_use_ipv6=$1\n\n   edr_expected_rules=()\n\n   # Reject all other traffic (removed -p ****\n   if [[ $whether_use_ipv6 == true ]]; then\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IP6TABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   else\n      edr_expected_rules+=(\"OUTPUT ! -o lo -j REJECT ${MDE_IPTABLE_TCP_REJECT_WITH_UNREACHABLE}\")\n   fi\n\n   # Intercept TCP inbound connection\n   edr_expected_rules+=(\"INPUT ! -i lo -p tcp ${MDE_PACKET_STAMP} ${MDE_TCP_PACKET_FILTER_SAVE} -j ${MDE_CHAIN}\")\n\n   # Allow inbound ssh (added -m tcp)\n   # edr_expected_rules+=(\"INPUT -i eth0 -p tcp -m tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT\")\n\n   # Allow DNS packets\n   edr_expected_rules+=(\"INPUT -p udp -m udp --sport 53 -j ACCEPT\")\n   edr_expected"
    },
    "AppGuardContainerId": "",
    "DeviceId": "875524232b2377b606ca585f2a6692b5be921b94",
    "DeviceName": "wazuh1.x0rsjvjofsvujdf53bjf3swsje.bx.internal.cloudapp.net",
    "FileName": "",
    "FileOriginIP": "",
    "FileOriginUrl": "",
    "FolderPath": "",
    "InitiatingProcessAccountDomain": "",
    "InitiatingProcessAccountName": "",
    "InitiatingProcessAccountObjectId": "",
    "InitiatingProcessAccountSid": "",
    "InitiatingProcessAccountUpn": "",
    "InitiatingProcessCommandLine": "",
    "InitiatingProcessFileName": "",
    "InitiatingProcessFolderPath": "",
    "InitiatingProcessId": 327139,
    "InitiatingProcessLogonId": 0,
    "InitiatingProcessMD5": "",
    "InitiatingProcessParentFileName": "",
    "InitiatingProcessParentId": 0,
    "InitiatingProcessSHA1": "",
    "InitiatingProcessSHA256": "",
    "LocalIP": "",
    "LocalPort": null,
    "LogonId": null,
    "MD5": "",
    "MachineGroup": "UnassignedGroup",
    "ProcessCommandLine": "",
    "ProcessId": null,
    "ProcessTokenElevation": "",
    "RegistryKey": "",
    "RegistryValueData": "",
    "RegistryValueName": "",
    "RemoteDeviceName": "",
    "RemoteIP": "",
    "RemotePort": null,
    "RemoteUrl": "",
    "ReportId": 118172,
    "SHA1": "",
    "SHA256": "99fbf178fce121f6153404781800931789102141d633a7be699af6be898cdc61",
    "Timestamp": "2025-11-04T07:20:55.663343Z",
    "TimeGenerated": "2025-11-04T07:20:55.663343Z",
    "FileSize": null,
    "InitiatingProcessCreationTime": "2025-11-04T07:20:55.606736Z",
    "InitiatingProcessFileSize": null,
    "InitiatingProcessParentCreationTime": null,
    "InitiatingProcessVersionInfoCompanyName": "",
    "InitiatingProcessVersionInfoFileDescription": "",
    "InitiatingProcessVersionInfoInternalFileName": "",
    "InitiatingProcessVersionInfoOriginalFileName": "",
    "InitiatingProcessVersionInfoProductName": "",
    "InitiatingProcessVersionInfoProductVersion": "",
    "ProcessCreationTime": null,
    "CreatedProcessSessionId": null,
    "IsProcessRemoteSession": false,
    "ProcessRemoteSessionDeviceName": "",
    "ProcessRemoteSessionIP": "",
    "InitiatingProcessSessionId": null,
    "IsInitiatingProcessRemoteSession": false,
    "InitiatingProcessRemoteSessionDeviceName": "",
    "InitiatingProcessRemoteSessionIP": "",
    "InitiatingProcessUniqueId": "0",
    "SourceSystem": "",
    "Type": "DeviceEvents"
  }
]